<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WNY App ‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</title>
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/1/15/Wny-logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    
<style>
        /* --- [ ADD-ON ] Glassmorphism Header --- */
div#main-app > header {
    background-color: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.4);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
}
        body { 
            font-family: 'Sarabun', sans-serif; 
            /* Change: ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà class ‡∏Ç‡∏≠‡∏á body ‡πÉ‡∏ô HTML ‡πÅ‡∏•‡πâ‡∏ß */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Change: ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡πÑ‡∏ï‡∏•‡πå Glassmorphism ‡∏´‡∏•‡∏±‡∏Å */
        .main-container { 
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px) saturate(180%);
            -webkit-backdrop-filter: blur(16px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1); /* Change: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡∏Ç‡∏∂‡πâ‡∏ô */
        }

        /* Change: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ InputField ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
        .form-input { 
            width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.5rem; 
            transition: all 0.15s ease-in-out; 
            background-color: rgba(255, 255, 255, 0.6); /* Glassy input */
        }
        .form-input:focus { 
            outline: none; border-color: #4f46e5; 
            box-shadow: 0 0 0 2px #c7d2fe; 
            background-color: rgba(255, 255, 255, 0.8); /* ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ focus */
        }
        .form-input::placeholder { color: #6b7280; } /* Tailwind gray-500 */

        .form-label { font-weight: bold; color: #374151; }
        .loader { border: 4px solid #f3f3f3; border-radius: 50%; border-top: 4px solid #3b82f6; width: 24px; height: 24px; animation: spin 2s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        fieldset { border-color: #e5e7eb; }
        
        /* Change: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Legend ‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏∂‡∏ö) */
        legend { 
            background-color: transparent; 
            padding: 0 0.5rem; 
            border-radius: 9999px; 
            font-weight: 700; 
            color: #4f46e5; 
            font-size: 1.25rem; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
            margin-left: 0.5rem;
        }

        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; font-weight: bold; padding: 0.6rem 1.25rem; border-radius: 0.5rem; transition: all 0.2s ease-in-out; cursor: pointer; border: none; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); }
        .btn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .btn-primary { background-color: #4f46e5; color: white; }
        .btn-primary:hover { background-color: #4338ca; } /* Add: ‡πÄ‡∏û‡∏¥‡πà‡∏° hover state */
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; } /* Add: ‡πÄ‡∏û‡∏¥‡πà‡∏° hover state */
        .btn-success { background-color: #10b981; color: white; }
        .btn-success:hover { background-color: #059669; } /* Add: ‡πÄ‡∏û‡∏¥‡πà‡∏° hover state */
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.875rem; }

        .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        /* Change: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Modal ‡πÄ‡∏õ‡πá‡∏ô Glassmorphism ‡∏î‡πâ‡∏ß‡∏¢ */
        .modal-content { 
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            margin: auto; padding: 20px; border: 1px solid rgba(255, 255, 255, 0.5); 
            width: 90%; max-width: 800px; border-radius: 0.75rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        /* Change: ‡πÉ‡∏ä‡πâ Glassmorphism ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π */
        .nav-button {
            padding: 1rem;
            text-align: center;
            border-radius: 0.75rem; /* rounded-xl */
            transition: all 0.2s ease-in-out;
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
        }
        .nav-button:hover {
            background-color: rgba(255, 255, 255, 0.9);
            transform: translateY(-3px); /* Add: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏¢ */
            box-shadow: 0 8px 20px 0 rgba(0, 0, 0, 0.1);
        }
        .nav-button.active { 
            background-color: rgba(224, 231, 255, 0.9); /* User's 'bg-e0e7ff' but glassy */
            border: 2px solid #4f46e5;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.15); /* Add: 'Glow' effect */
        }
        /* Add: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ text ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ .active ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
        .nav-button.active h3 { color: #4f46e5; }
        .nav-button:not(.active) h3 { color: #374151; }

        /* Change: ‡πÉ‡∏ä‡πâ Glassmorphism ‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ */
        .stat-card { 
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
        }
        .stat-card h3 { font-size: 1.25rem; font-weight: 700; color: #111827; }
        .stat-item { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(243, 244, 246, 0.6); cursor: pointer; transition: background-color 0.2s; }
        .stat-item:hover { background-color: rgba(239, 246, 255, 0.7); }
        .stat-item:last-child { border-bottom: none; }
        
        .tab-button { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; }
        .tab-button.active { background-color: #4f46e5; color: white; }
        .tab-button:not(.active) { background-color: rgba(224, 231, 255, 0.7); color: #4f46e5; }
        /* --- [ ADD-ON ] Glassmorphism Charts --- */
       .chart-container {
    position: relative;
    background-color: rgba(255, 255, 255, 0.8) !important;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05) !important;
    border-radius: 0.75rem;
    padding: 1.5rem;
    min-height: 300px;
}
        /* Change: ‡πÉ‡∏ä‡πâ Glassmorphism ‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å */
        .info-section { 
            margin-top: 1.5rem; 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
        }
        .info-section h3 { font-size: 1.25rem; font-weight: 700; color: #111827; margin-bottom: 1rem; }
        .info-section ul { list-style-type: disc; margin-left: 1.5rem; }
        .info-section li { margin-bottom: 0.5rem; }
        .info-note { background-color: #fef3cd; border-left: 4px solid #f59e0b; padding: 0.75rem; margin-top: 1rem; border-radius: 0.375rem; }
        
        .page-view { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- [ ADD-ON ] Glassmorphism Cards & Tables --- */

        /* 1. Dashboard: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Request List Items) */
        /* ‡πÉ‡∏ä‡πâ !important ‡πÄ‡∏û‡∏∑‡πà‡∏≠ override 'bg-white' ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å JavaScript */
        div#requests-list > div {
            background-color: rgba(255, 255, 255, 0.8) !important; 
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-in-out;
        }

        /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô hover */
        div#requests-list > div:hover {
            background-color: rgba(255, 255, 255, 0.95) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px 0 rgba(0, 0, 0, 0.07);
        }
.chart-container canvas {
    width: 100% !important;
    height: 100% !important;
    display: block;
}

/* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏£‡∏≤‡∏ü‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
@media (max-width: 768px) {
    .chart-container canvas {
        height: 250px !important;
    }
}

/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü responsive */
.chart-container {
    position: relative;
    min-height: 300px;
}
        /* 2. Stats Page: ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• (Summary Cards) */
        /* ‡πÉ‡∏ä‡πâ !important ‡πÄ‡∏û‡∏∑‡πà‡∏≠ override 'bg-white' ‡πÅ‡∏•‡∏∞ 'shadow' ‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏à‡∏≤‡∏Å JavaScript */
        div#stats-overview div[class*="bg-white"] {
            background-color: rgba(255, 255, 255, 0.8) !important; 
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05) !important;
        }

        /* 3. Stats Page: ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (Monthly Stats Table) */
        div#stats-page table {
            width: 100%;
            border-collapse: collapse; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô */
            border-radius: 0.75rem; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏°‡∏ô */
            overflow: hidden; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡∏°‡∏ô */
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Table Header) */
        div#stats-page table thead tr {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.4);
        }
        div#stats-page table th {
            padding: 0.75rem 1rem;
            text-align: left;
            font-weight: 700;
            color: #374151; /* gray-700 */
        }
        
        /* ‡πÅ‡∏ñ‡∏ß‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Table Body Rows) */
        div#stats-page table tbody tr {
            background-color: rgba(255, 255, 255, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            transition: background-color 0.2s;
        }
        div#stats-page table tbody tr:last-child {
            border-bottom: none; /* ‡πÅ‡∏ñ‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö */
        }
        div#stats-page table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.8);
        }
        div#stats-page table td {
            padding: 0.75rem 1rem;
            color: #4b5563; /* gray-600 */
        }

        /* 4. [Bonus] Admin Page: ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å */
        div#admin-requests-list > div,
        div#admin-memos-list > div {
            background-color: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px 0 rgba(0, 0, 0, 0.05);
        }
        
    </style>
</head>
<body class="p-4 sm:p-8 min-h-screen bg-gradient-to-br from-pink-100 to-blue-200 antialiased">
    <div id="app" class="max-w-6xl mx-auto">
        <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î -->
        <div id="login-screen" class="max-w-6xl mx-auto mt-10 pb-20">
            
            <div class="max-w-md mx-auto mb-12">
                <div class="p-8 rounded-2xl shadow-2xl main-container transform hover:scale-105 transition duration-300">
                    <div class="text-center mb-6">
                        <img src="https://img2.pic.in.th/pic/WNY-App-.png" alt="Logo" class="mx-auto h-28 mb-4 drop-shadow-md">
                    </div>
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="username" class="form-label text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Username)</label>
                            <input type="text" id="username" class="form-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                        </div>
                        <div class="mb-6">
                            <label for="password" class="form-label text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)</label>
                            <input type="password" id="password" class="form-input" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                        </div>
                        <button type="submit" id="login-button" class="btn btn-primary w-full text-lg shadow-lg">
                            <div id="login-loader" class="loader hidden"></div>
                            <span id="login-button-text">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                        </button>
                        <p id="login-error" class="text-red-500 text-center mt-4 hidden bg-red-50 p-2 rounded"></p>
                    </form>
                    <p class="text-center mt-4 text-sm text-gray-600 hidden">
                        ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? <button type="button" id="show-register-modal-button" class="font-semibold text-indigo-600 hover:text-indigo-500">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</button>
                    </p>
                    <p class="text-center mt-4">
                        <button type="button" id="show-forgot-password-modal" class="font-semibold text-indigo-600 hover:text-indigo-500 text-sm">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?</button>
                    </p>
                </div>
            </div>
        <div class="w-full mb-10">
                <div class="p-6 rounded-2xl shadow-xl main-container bg-white/80 backdrop-blur-sm border border-white/50">
                    <div class="flex flex-wrap justify-between items-end mb-4 border-b pb-4 border-gray-200 gap-4">
                        <div>
                            <h2 class="text-xl font-bold text-blue-800 flex items-center gap-2">
                                <span class="bg-blue-100 p-2 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                </span>
                                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                            </h2>
                            <p class="text-sm text-gray-500 mt-2 ml-1">
                                <span class="text-green-600 font-bold">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> 
                                ‡∏´‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∞‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏° <span class="bg-green-100 text-green-800 text-xs px-2 py-0.5 rounded border border-green-200">üìÑ ‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</span> ‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏∂‡πâ‡∏ô
                            </p>
                        </div>
                        <span class="text-sm font-medium text-indigo-600 bg-indigo-50 px-4 py-2 rounded-full shadow-inner border border-indigo-100" id="current-week-display">
                            Loading...
                        </span>
                    </div>
                    
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="w-full text-sm text-left">
                            <thead class="text-sm text-gray-700 uppercase bg-gradient-to-r from-blue-50 to-indigo-50 border-b">
                                <tr>
                                    <th scope="col" class="px-6 py-4 font-bold">‡∏ß‡∏±‡∏ô-‡πÄ‡∏ß‡∏•‡∏≤</th>
                                    <th scope="col" class="px-6 py-4 font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠</th>
                                    <th scope="col" class="px-6 py-4 font-bold">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th scope="col" class="px-6 py-4 font-bold text-center">‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</th>
                                </tr>
                            </thead>
                            <tbody id="public-weekly-list" class="bg-white divide-y divide-gray-100">
                                <tr>
                                    <td colspan="4" class="text-center py-10">
                                        <div class="loader mx-auto mb-3"></div>
                                        <span class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå 2 ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢) -->
                <div class="info-section">
                    <h3 class="text-lg font-bold text-blue-700 mb-4">1. ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)</h3>
                    <p class="font-medium mb-2">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°:</p>
                    <ul class="list-disc pl-5 mb-2">
                        <li>‡∏£‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏™‡πà‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</li> 
                        <p class="font-medium mb-2"></pclass>(‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏á 1 ‡∏ä‡∏∏‡∏î)</p>
                        <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</li>
                        <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ (‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)</li>
                    </ul>
                    <div class="info-note">
                        <p class="font-medium">‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡∏û‡∏±‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</p> 
                         <span class="font-bold">‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏á 1 ‡∏ä‡∏∏‡∏î</span>
                        <ul class="list-disc pl-5 mt-1">
                            <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</li>
                            <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</li>
                            <li>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (Google map)</li>
                        </ul>
                    </div>
                </div>
                
                <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢) -->
                <div class="info-section">
                    <h3 class="text-lg font-bold text-green-700 mb-4">2. ‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢)</h3>
                    <p class="font-medium mb-2">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°:</p>
                    <ul class="list-disc pl-5 mb-2">
                        <li>‡∏£‡πà‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏Å‡∏î‡∏™‡πà‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)</li>
                        <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</li>
                        <li>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£ (‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)</li>
                    </ul>
                    <div class="info-note">
                        <p class="font-medium">‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ‡∏û‡∏±‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</p> 
                        <span class="font-bold">‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏á 1 ‡∏ä‡∏∏‡∏î</span>
                        <ul class="list-disc pl-5 mt-1">
                            <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</li>
                            <li>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á</li>
                            <li>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (Google map)</li>
                        </ul>
                    </div>
                </div>
            </div>
            
     <!-- Footer -->
            <footer class="text-center text-sm text-gray-500 mt-8 pb-4">
                <p>‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏° </p>
                <p>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏Å‡∏µ‡∏£‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡∏™‡∏û‡∏û‡∏£‡∏£‡∏±‡∏á‡∏™‡∏µ </p>
            </footer>
        </div></div>
        <div id="main-app" class="hidden">
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å -->
        <header class="p-4 rounded-xl mb-6 flex flex-wrap justify-between items-center gap-4">
    <div class="flex items-center gap-4">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/15/Wny-logo.png" alt="Logo" class="h-12 w-12 object-contain">
        <div>
            <h2 class="text-xl font-bold text-gray-800">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, <span id="user-fullname"></span></h2>
            <p class="text-sm text-gray-500">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: <span id="user-position"></span></p>
        </div>
    </div>
    
    <button id="logout-button" class="btn btn-danger">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
</header>

            <!-- ‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏≥‡∏ó‡∏≤‡∏á -->
            <div id="navigation" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 mb-6">
                <button data-target="dashboard-page" id="user-nav-dashboard" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition active">
                    <h3 class="font-bold text-indigo-700">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h3>
                    <p class="text-xs text-gray-500">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </button>
                <button data-target="form-page" id="user-nav-form" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition">
                    <h3 class="font-bold text-indigo-700">‡∏£‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h3>
                    <p class="text-xs text-gray-500">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                </button>
                <button data-target="edit-page" id="nav-edit" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition hidden">
                    <h3 class="font-bold text-orange-700">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                    <p class="text-xs text-gray-500">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</p>
                </button>
                 <button data-target="command-generation-page" id="admin-nav-command" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition hidden">
                    <h3 class="font-bold text-purple-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</h3>
                    <p class="text-xs text-gray-500">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
                </button>
                 <button data-target="stats-page" id="nav-stats" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition">
                    <h3 class="font-bold text-green-700">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <p class="text-xs text-gray-500">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</p>
                </button>
                <button data-target="profile-page" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition">
                    <h3 class="font-bold text-indigo-700">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                    <p class="text-xs text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </button>
                <button id="admin-nav-users" data-target="admin-users-page" class="nav-button p-4 text-center bg-white rounded-lg shadow hover:bg-indigo-50 transition hidden">
                    <h3 class="font-bold text-red-700">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <p class="text-xs text-gray-500">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </button>
            </div>

            <!-- ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
            <main id="page-content" class="p-6 sm:p-8 rounded-2xl">
                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î -->
                <div id="dashboard-page" class="page-view">
                    <h2 class="text-2xl font-bold mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                    <input type="text" id="search-requests" class="form-input mb-4" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏•‡∏Ç‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á...">
                    <div id="requests-loader" class="text-center p-8">
                        <div class="loader mx-auto"></div><p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠...</p>
                    </div>
                    <div id="requests-list" class="hidden"></div>
                    <p id="no-requests-message" class="text-center text-gray-500 p-8 hidden">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                </div>

                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡∏°‡πà -->
                <div id="form-page" class="page-view hidden">
                     <form id="request-form">
                          <input type="hidden" id="form-request-id">
                            <fieldset class="border p-4 rounded-lg mb-6"><legend>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</legend>
                                <div><label for="form-doc-date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="form-doc-date" class="form-input" required></div>
                          </fieldset>
                         <fieldset class="border p-4 rounded-lg mb-6"><legend>1. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</legend>
                               <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                   <div><label for="form-requester-name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠</label><input type="text" id="form-requester-name" class="form-input" required></div>
                                   <div><label for="form-requester-position" class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label><input type="text" id="form-requester-position" class="form-input" required></div>
                              </div>
                             <div class="mt-4"><label for="form-location" class="form-label">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏ì ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label><input type="text" id="form-location" class="form-input" required></div>
                             <div class="mt-4"><label for="form-purpose" class="form-label">‡πÄ‡∏û‡∏∑‡πà‡∏≠</label><textarea id="form-purpose" rows="2" class="form-input" required></textarea></div>
                             <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                   <div><label for="form-start-date" class="form-label">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="form-start-date" class="form-input" required></div>
                                   <div><label for="form-end-date" class="form-label">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="form-end-date" class="form-input" required></div>
                              </div>
                         </fieldset>
                            <fieldset class="border p-4 rounded-lg mb-6"><legend>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</legend>
                                <div id="form-attendees-list"></div>
                                <div class="flex flex-wrap gap-2 mt-4">
                                    <button type="button" id="form-add-attendee" class="btn btn-success w-full sm:w-auto"><span>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</span></button>
                                    <button type="button" id="form-import-excel" class="btn btn-primary w-full sm:w-auto">
                                        <div id="import-excel-loader" class="loader hidden"></div>
                                        <span>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel</span>
                                    </button>
                                    <button type="button" id="form-download-template" class="btn bg-gray-500 text-white hover:bg-gray-600 w-full sm:w-auto"><span>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö</span></button>
                                    <input type="file" id="excel-file-input" class="hidden" accept=".xlsx, .xls">
                                </div>
                          </fieldset>
                            <fieldset class="border p-4 rounded-lg mb-6"><legend>2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</legend>
                                <div class="space-y-3">
                                    <div><input type="radio" id="expense_no" name="expense_option" value="no" checked class="h-4 w-4"><label for="expense_no" class="ml-2">‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label></div>
                                    <div><input type="radio" id="expense_partial" name="expense_option" value="partial" class="h-4 w-4"><label for="expense_partial" class="ml-2">‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label></div>
                              </div>
                             <div id="partial-expense-options" class="pl-6 mt-3 hidden space-y-2">
                                  <label class="block"><input type="checkbox" name="expense_item" value="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á" data-item-name="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á" class="rounded"> ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label>
                                  <label class="block"><input type="checkbox" name="expense_item" value="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" data-item-name="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                                  <label class="block"><input type="checkbox" name="expense_item" value="‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å" data-item-name="‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</label>
                                  <label class="block"><input type="checkbox" name="expense_item" value="‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞" data-item-name="‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞</label>
                                  <label class="block"><input type="checkbox" name="expense_item" value="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô" data-item-name="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</label>
                                  <div class="flex items-center gap-2"><label><input type="checkbox" name="expense_item" id="expense_other_check" data-item-name="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="rounded"> ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label><input type="text" id="expense_other_text" class="form-input text-sm p-1 flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏"></div>
                             </div>
                             <div id="total-expense-container" class="mt-4 hidden"><label for="form-total-expense" class="form-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input type="number" id="form-total-expense" class="form-input w-full md:w-1/2" placeholder="0.00" step="0.01"></div>
                          </fieldset>
                            <fieldset class="border p-4 rounded-lg mb-6">
                                    <legend>3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</legend><div class="space-y-2">
                                    <label class="block">
                                    <input type="checkbox" name="vehicle_option" value="gov" class="rounded">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡∏£‡∏ñ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</label>
                                    <label class="block">
                                    <input type="checkbox" name="vehicle_option" value="private" class="rounded">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</label>
                                    <div id="private-vehicle-details" class="pl-6 mt-2 hidden">
                                    <label for="form-license-plate" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="form-license-plate" class="form-input w-full md:w-1/2"></div>
                                    <label class="block"><input type="checkbox" name="vehicle_option" value="public" class="rounded">‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                                    <div id="public-vehicle-details" class="pl-6 mt-2 hidden">
                                    <label for="form-public-vehicle-details" class="form-label">‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label><input type="text" id="form-public-vehicle-details" class="form-input w-full md:w-1/2"></div>
                             </div>
                         </fieldset>
                          <fieldset id="signer-fieldset" class="border p-4 rounded-lg mb-6"><legend>5. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</legend>
                                <div class="mb-4">
                                    <label for="form-department" class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Ø / ‡∏á‡∏≤‡∏ô</label>
                                    <select id="form-department" class="form-input" required>
                                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏á‡∏≤‡∏ô --</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                        <option value="‡∏£‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ">(‡∏£‡∏≠‡∏á)‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏®‡∏¥‡∏•‡∏õ‡∏∞">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏®‡∏¥‡∏•‡∏õ‡∏∞</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                                        <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                        <option value=".....................................">.....................................</option>
                                    </select>
                                </div>
                                <div><label for="form-head-name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞ / ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</label><input type="text" id="form-head-name" class="form-input bg-gray-200" readonly></div>
                         </fieldset>
                         <div class="text-center mt-10 border-t pt-6 border-gray-200">
                              <button type="submit" id="submit-request-button" class="btn btn-primary w-full sm:w-auto text-lg">
                                <div id="submit-loader" class="loader hidden"></div>
                                <span id="submit-button-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                             </button>
                         </div>
                    </form>
                      <div id="form-result" class="hidden mt-6 p-6 text-center">
                          <h3 id="form-result-title" class="font-bold text-lg"></h3>
                          <p id="form-result-message" class="mt-2 text-gray-700"></p>
                            <div class="flex justify-center flex-wrap gap-4 mt-4">
                                <a id="form-result-link" href="#" target="_blank" class="btn btn-success">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF</a>
                             </div>
                      </div>
                </div>

                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠ -->
                <div id="edit-page" class="page-view hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h2>
                        <button id="back-to-dashboard" class="btn bg-gray-500 text-white">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
                    </div>
                    
                    <form id="edit-request-form">
                        <input type="hidden" id="edit-draft-id">
                        <input type="hidden" id="edit-request-id">
                        
                        <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</legend>
                            <div>
                                <label for="edit-doc-date" class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="date" id="edit-doc-date" class="form-input" required>
                            </div>
                        </fieldset>
                        
                        <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>1. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="edit-requester-name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠</label>
                                    <input type="text" id="edit-requester-name" class="form-input" required>
                                </div>
                                <div>
                                    <label for="edit-requester-position" class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                                    <input type="text" id="edit-requester-position" class="form-input" required>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label for="edit-location" class="form-label">‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏ì ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
                                <input type="text" id="edit-location" class="form-input" required>
                            </div>
                            <div class="mt-4">
                                <label for="edit-purpose" class="form-label">‡πÄ‡∏û‡∏∑‡πà‡∏≠</label>
                                <textarea id="edit-purpose" rows="2" class="form-input" required></textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label for="edit-start-date" class="form-label">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="date" id="edit-start-date" class="form-input" required>
                                </div>
                                <div>
                                    <label for="edit-end-date" class="form-label">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                                    <input type="date" id="edit-end-date" class="form-input" required>
                                </div>
                            </div>
                        </fieldset>
                        
                        <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</legend>
                            <div id="edit-attendees-list"></div>
                            <div class="flex flex-wrap gap-2 mt-4">
                                <button type="button" id="edit-add-attendee" class="btn btn-success w-full sm:w-auto">
                                    <span>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</span>
                                </button>
                            </div>
                        </fieldset>
                        
                        <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>2. ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</legend>
                            <div class="space-y-3">
                                <div><input type="radio" id="edit-expense_no" name="edit-expense_option" value="no" checked class="h-4 w-4"><label for="edit-expense_no" class="ml-2">‡πÑ‡∏°‡πà‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label></div>
                                <div><input type="radio" id="edit-expense_partial" name="edit-expense_option" value="partial" class="h-4 w-4"><label for="edit-expense_partial" class="ml-2">‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label></div>
                            </div>
                            <div id="edit-partial-expense-options" class="pl-6 mt-3 hidden space-y-2">
                                <label class="block"><input type="checkbox" name="edit-expense_item" value="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á" data-item-name="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á" class="rounded"> ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á</label>
                                <label class="block"><input type="checkbox" name="edit-expense_item" value="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" data-item-name="‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                                <label class="block"><input type="checkbox" name="edit-expense_item" value="‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å" data-item-name="‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</label>
                                <label class="block"><input type="checkbox" name="edit-expense_item" value="‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞" data-item-name="‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞</label>
                                <label class="block"><input type="checkbox" name="edit-expense_item" value="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô" data-item-name="‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô" class="rounded"> ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</label>
                                <div class="flex items-center gap-2"><label><input type="checkbox" name="edit-expense_item" id="edit-expense_other_check" data-item-name="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ" class="rounded"> ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label><input type="text" id="edit-expense_other_text" class="form-input text-sm p-1 flex-grow" placeholder="‡∏£‡∏∞‡∏ö‡∏∏"></div>
                            </div>
                            <div id="edit-total-expense-container" class="mt-4 hidden"><label for="edit-total-expense" class="form-label">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label><input type="number" id="edit-total-expense" class="form-input w-full md:w-1/2" placeholder="0.00" step="0.01"></div>
                        
                       <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>3. ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</legend>
                            <div class="space-y-2">
                                <label class="block">
                                    <input type="checkbox" id="edit-vehicle_gov" name="edit-vehicle_option" value="gov" class="rounded">
                                    ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡∏£‡∏ñ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)
                                </label>
                                
                                <label class="block">
                                    <input type="checkbox" id="edit-vehicle_private" name="edit-vehicle_option" value="private" class="rounded">
                                    ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
                                </label>
                                
                                <div id="edit-private-vehicle-details" class="pl-6 mt-2 hidden">
                                    <label for="edit-license-plate" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="edit-license-plate" class="form-input w-full md:w-1/2">
                                </div>
                                
                                <label class="block">
                                    <input type="checkbox" id="edit-vehicle_public" name="edit-vehicle_option" value="public" class="rounded">
                                    ‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                                </label>
                                
                                <div id="edit-public-vehicle-details" class="pl-6 mt-2 hidden">
                                    <label for="edit-public-vehicle-details" class="form-label">‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                                    <input type="text" id="edit-public-vehicle-details" class="form-input w-full md:w-1/2">
                                </div>
                            </div>
                        </fieldset>
                        <fieldset class="border p-4 rounded-lg mb-6">
                            <legend>5. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</legend>
                            <div class="mb-4">
                                <label for="edit-department" class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Ø / ‡∏á‡∏≤‡∏ô</label>
                                <select id="edit-department" class="form-input" required>
                                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏á‡∏≤‡∏ô --</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                    <option value="‡∏£‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ">(‡∏£‡∏≠‡∏á)‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏®‡∏¥‡∏•‡∏õ‡∏∞">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏®‡∏¥‡∏•‡∏õ‡∏∞</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option>
                                    <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£</option>
                                    <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                                    <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                                    <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                                    <option value=".....................................">.....................................</option>
                                </select>
                            </div>
                            <div>
                                <label for="edit-head-name" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞ / ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</label>
                                <input type="text" id="edit-head-name" class="form-input bg-gray-200" readonly>
                            </div>
                        </fieldset>
                        
                        <div class="flex justify-center gap-4 mt-10 border-t pt-6 border-gray-200">

                            <button type="button" id="generate-document-button" class="btn btn-primary text-lg">
                                <div id="generate-doc-loader" class="loader hidden"></div>
                                <span id="generate-doc-button-text">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</span>
                            </button>
                        </div>
                    </form>
                    
                    <div id="edit-result" class="hidden mt-6 p-6 text-center">
                        <h3 id="edit-result-title" class="font-bold text-lg"></h3>
                        <p id="edit-result-message" class="mt-2 text-gray-700"></p>
                        <div class="flex justify-center flex-wrap gap-4 mt-4">
                            <a id="edit-result-link" href="#" target="_blank" class="btn btn-success">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå PDF ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a>
                        </div>
                    </div>
                </div>

                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå -->
                <div id="profile-page" class="page-view hidden">
                    <h2 class="text-2xl font-bold mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                            <form id="profile-form">
                                <div class="mb-4">
                                    <label for="profile-username" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                                    <input type="text" id="profile-username" class="form-input bg-gray-200" readonly>
                                </div>
                                <div class="mb-4">
                                    <label for="profile-loginname" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô (ID ‡πÉ‡∏´‡∏°‡πà)</label>
                                    <input type="text" id="profile-loginname" class="form-input" required>
                                </div>
                                    <div class="mb-4">
                                    <label for="profile-fullname" class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="profile-fullname" class="form-input" required>
                                </div>
                                <div class="mb-4">
                                    <label for="profile-position" class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                                    <input type="text" id="profile-position" class="form-input" required>
                                </div>
                                <div class="mb-4">
                                    <label for="profile-department" class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏á‡∏≤‡∏ô</label>
                                    <input type="text" id="profile-department" class="form-input" required>
                                </div>
                                <div class="mb-4">
                                    <label for="profile-email" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)</label>
                                    <input type="email" id="profile-email" class="form-input" required>
                                </div>
                                <button type="submit" id="profile-submit-button" class="btn btn-primary w-full">
                                    <div id="profile-loader" class="loader hidden"></div>
                                    <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                                </button>
                                </form>
                                </div>
                        
                        <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
                        <div class="bg-gray-50 p-6 rounded-lg">
                            <h3 class="text-xl font-bold mb-4">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
                            <form id="password-form">
                                <div class="mb-4">
                                    <label for="current-password" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                    <input type="password" id="current-password" class="form-input" required>
                                </div>
                                <div class="mb-4">
                                    <label for="new-password" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</label>
                                    <input type="password" id="new-password" class="form-input" required>
                                </div>
                                <div class="mb-4 flex items-center">
                                    <input type="checkbox" id="show-password-toggle" class="h-4 w-4">
                                    <label for="show-password-toggle" class="ml-2 text-sm">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                                </div>
                                <button type="submit" id="password-submit-button" class="btn btn-primary w-full">
                                    <div id="password-loader" class="loader hidden"></div>
                                    <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏î‡∏¢ Admin -->
                <div id="admin-command-page" class="page-view hidden">
                    <h2 class="text-2xl font-bold mb-6">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h2>
                <div id="admin-command-info"></div>
                <div class="flex gap-4 mt-6">
                <button id="generate-command-solo" class="btn btn-primary">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß</button>
                <button id="generate-command-group-small" class="btn btn-primary">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å</button>
                <button id="generate-command-group-large" class="btn btn-primary">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà</button>
                </div>
                </div>
                <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô page-content -->
<div id="admin-generate-command-page" class="page-view hidden">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h2>
        <button id="back-to-admin-command" class="btn bg-gray-500 text-white">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
    </div>
    
    <form id="admin-command-form">
        <input type="hidden" id="admin-command-request-id">
        
        <fieldset class="border p-4 rounded-lg mb-6">
            <legend>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠</legend>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠</label>
                    <p id="admin-command-request-id-display" class="font-bold text-indigo-700"></p>
                </div>
                <div>
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</label>
                    <p id="admin-command-doc-date-display"></p>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠</label>
                    <p id="admin-command-requester-name"></p>
                </div>
                <div>
                    <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <p id="admin-command-requester-position"></p>
                </div>
            </div>
            <div class="mb-4">
                <label class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</label>
                <p id="admin-command-location"></p>
            </div>
            <div class="mb-4">
                <label class="form-label">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
                <p id="admin-command-purpose"></p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</label>
                    <p id="admin-command-start-date"></p>
                </div>
                <div>
                    <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
                    <p id="admin-command-end-date"></p>
                </div>
            </div>
        </fieldset>
        
        <fieldset class="border p-4 rounded-lg mb-6">
            <legend>‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</legend>
            <div id="admin-command-attendees-list"></div>
        </fieldset>
        
        <fieldset class="border p-4 rounded-lg mb-6">
            <legend>‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</legend>
            <div id="admin-command-expense-info"></div>
        </fieldset>
        
        <fieldset class="border p-4 rounded-lg mb-6">
            <legend>‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</legend>
            <div id="admin-command-vehicle-info"></div>
        </fieldset>
        
        <fieldset class="border p-4 rounded-lg mb-6">
            <legend>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</legend>
            <div class="space-y-3">
                <div>
                    <input type="radio" id="admin-command-type-solo" name="admin-command-type" value="solo" class="h-4 w-4">
                    <label for="admin-command-type-solo" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß (1 ‡∏Ñ‡∏ô)</label>
                </div>
                <div>
                    <input type="radio" id="admin-command-type-group-small" name="admin-command-type" value="groupSmall" class="h-4 w-4">
                    <label for="admin-command-type-group-small" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å (2-5 ‡∏Ñ‡∏ô)</label>
                </div>
                <div>
                    <input type="radio" id="admin-command-type-group-large" name="admin-command-type" value="groupLarge" class="h-4 w-4">
                    <label for="admin-command-type-group-large" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà (6 ‡∏Ñ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)</label>
                </div>
            </div>
        </fieldset>
        
        <div class="flex justify-center gap-4 mt-10 border-t pt-6 border-gray-200">
            <button type="button" id="admin-generate-command-button" class="btn btn-primary text-lg">
                <div id="admin-generate-command-loader" class="loader hidden"></div>
                <span id="admin-generate-command-button-text">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</span>
            </button>
        </div>
    </form>
    
    <div id="admin-command-result" class="hidden mt-6 p-6 text-center">
        <h3 id="admin-command-result-title" class="font-bold text-lg"></h3>
        <p id="admin-command-result-message" class="mt-2 text-gray-700"></p>
        <div class="flex justify-center flex-wrap gap-4 mt-4">
            <a id="admin-command-result-link" href="#" target="_blank" class="btn btn-success">‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</a>
        </div>
    </div>
</div>
                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Admin) -->
                <div id="admin-users-page" class="page-view hidden">
                    <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2>
                    
                    <div class="mb-6 flex flex-wrap gap-4">
                        <button id="add-user-button" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
                        <button id="download-user-template-button" class="btn bg-green-500 text-white">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö</button>
                        <button id="import-users-button" class="btn bg-blue-500 text-white">‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel</button>
                        <input type="file" id="user-excel-input" class="hidden" accept=".xlsx, .xls">
                    </div>
                    
                    <div id="users-list" class="bg-white rounded-lg shadow">
                        <div class="p-4 border-b">
                            <h3 class="font-bold">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                        </div>
                        <div id="users-content" class="p-4">
                            <div class="text-center p-8">
                                <div class="loader mx-auto"></div>
                                <p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (Admin) -->
                <div id="command-generation-page" class="page-view hidden">
                    <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</h2>
                    
                    <div class="flex gap-4 mb-6">
                        <button id="admin-view-requests-tab" class="tab-button active">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</button>
                        <button id="admin-view-memos-tab" class="tab-button">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                    </div>
                    
                    <!-- ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ -->
                    <div id="admin-requests-view">
                        <div class="mb-4">
                            <input type="text" id="admin-search-requests" class="form-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏Ç‡∏≠...">
                        </div>
                        <div id="admin-requests-list" class="space-y-4">
                            <div class="text-center p-8">
                                <div class="loader mx-auto"></div>
                                <p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
                    <div id="admin-memos-view" class="hidden">
                        <div class="mb-4">
                            <input type="text" id="admin-search-memos" class="form-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
                        </div>
                        <div id="admin-memos-list" class="space-y-4">
                            <div class="text-center p-8">
                                <div class="loader mx-auto"></div>
                                <p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
                <div id="stats-page" class="page-view hidden">
                    <h2 class="text-2xl font-bold mb-6">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                    
                    <div class="mb-6 flex flex-wrap gap-4">
                        <button id="refresh-stats" class="btn btn-primary">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                            ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button id="export-stats" class="btn bg-green-500 text-white">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </button>
                    </div>

                    <div id="stats-overview" class="space-y-6">
                        <div class="text-center p-8">
                            <div class="loader mx-auto"></div>
                            <p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...</p>
                        </div>
                    </div>

                    <!-- ‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ -->
                    <div id="stats-charts" class="mt-8 hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            
                            <div class="chart-container">
                                <h3 class="text-lg font-bold mb-4 text-gray-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
                                <canvas id="requests-chart" width="400" height="200"></canvas>
                            </div>
                            
                            <div class="chart-container">
                                <h3 class="text-lg font-bold mb-4 text-gray-800">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                                <canvas id="status-chart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
            
            <!-- Footer -->
            <footer class="text-center text-sm text-gray-500 mt-8 pb-4">
                <p>‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏¢‡πá‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏° </p>
                <p>‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏Å‡∏µ‡∏£‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡∏™‡∏û‡∏û‡∏£‡∏£‡∏±‡∏á‡∏™‡∏µ </p>
            </footer>
        </div></div>

        <!-- Modal ‡∏ï‡πà‡∏≤‡∏á‡πÜ -->
        <!-- Modal ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
        <div id="register-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</h3>
                    <button id="register-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <form id="register-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="register-username" class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                            <input type="text" id="register-username" class="form-input" required>
                        </div>
                        <div>
                            <label for="register-password" class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                            <input type="password" id="register-password" class="form-input" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="register-fullname" class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" id="register-fullname" class="form-input" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-position" class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                        <input type="text" id="register-position" class="form-input" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-department" class="form-label">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏á‡∏≤‡∏ô</label>
                        <input type="text" id="register-department" class="form-input" required>
                    </div>
                    <div class="mb-4">
                        <label for="register-email" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)</label>
                        <input type="email" id="register-email" class="form-input" required>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="register-modal-close-button2" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="register-submit-button" class="btn btn-primary">
                            <div id="register-loader" class="loader hidden"></div>
                            <span>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
        <div id="alert-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="alert-modal-title" class="text-xl font-bold">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
                    <button id="alert-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <p id="alert-modal-message" class="mb-6"></p>
                <div class="flex justify-end">
                    <button id="alert-modal-ok-button" class="btn btn-primary">‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            </div>
        </div>

        <!-- Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô -->
        <div id="confirm-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="confirm-modal-title" class="text-xl font-bold">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</h3>
                    <button id="confirm-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <p id="confirm-modal-message" class="mb-6"></p>
                <div class="flex justify-end gap-4">
                    <button id="confirm-modal-no-button" class="btn bg-gray-500 text-white">‡πÑ‡∏°‡πà</button>
                    <button id="confirm-modal-yes-button" class="btn btn-primary">‡πÉ‡∏ä‡πà</button>
                </div>
            </div>
        </div>

        <!-- Modal ‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° -->
        <div id="send-memo-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
                    <button id="send-memo-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <form id="send-memo-form">
                    <input type="hidden" id="memo-modal-request-id">
                    <div class="mb-4">
                        <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                        <div class="space-y-2">
                            <div>
                                <input type="radio" id="memo_type_reimburse" name="modal_memo_type" value="reimburse" class="h-4 w-4">
                                <label for="memo_type_reimburse" class="ml-2">‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label>
                            </div>
                            <div>
                                <input type="radio" id="memo_type_non_reimburse" name="modal_memo_type" value="non_reimburse" class="h-4 w-4" checked>
                                <label for="memo_type_non_reimburse" class="ml-2">‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</label>
                            </div>
                        </div>
                    </div>
                    <div id="modal-memo-file-container" class="mb-4">
                        <label for="modal-memo-file" class="form-label">‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
                        <input type="file" id="modal-memo-file" class="form-input" accept=".pdf,.doc,.docx">
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="send-memo-cancel-button" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="send-memo-submit-button" class="btn btn-primary">
                            <div id="send-memo-loader" class="loader hidden"></div>
                            <span>‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á -->
        <div id="command-approval-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h3>
                    <button id="command-approval-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <form id="command-approval-form">
                    <input type="hidden" id="command-request-id">
                    <div class="mb-4">
                        <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</label>
                        <div class="space-y-2">
                            <div>
                                <input type="radio" id="command_type_solo" name="command_type" value="solo" class="h-4 w-4">
                                <label for="command_type_solo" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß (1 ‡∏Ñ‡∏ô)</label>
                            </div>
                            <div>
                                <input type="radio" id="command_type_group_small" name="command_type" value="groupSmall" class="h-4 w-4">
                                <label for="command_type_group_small" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å (2-5 ‡∏Ñ‡∏ô)</label>
                            </div>
                            <div>
                                <input type="radio" id="command_type_group_large" name="command_type" value="groupLarge" class="h-4 w-4">
                                <label for="command_type_group_large" class="ml-2">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà (6 ‡∏Ñ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)</label>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="command-approval-cancel-button" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="command-approval-submit-button" class="btn btn-primary">
                            <div id="command-approval-loader" class="loader hidden"></div>
                            <span>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal ‡∏™‡πà‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á -->
        <div id="dispatch-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</h3>
                    <button id="dispatch-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <form id="dispatch-form">
                    <input type="hidden" id="dispatch-request-id">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="dispatch-month" class="form-label">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                            <select id="dispatch-month" class="form-input" required>
                                <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô --</option>
                                <option value="‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                                <option value="‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°">‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô">‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô</option>
                                <option value="‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°">‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô">‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô</option>
                                <option value="‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°">‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°">‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô">‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô</option>
                                <option value="‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°">‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°</option>
                                <option value="‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô">‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô</option>
                                <option value="‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°">‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°</option>
                            </select>
                        </div>
                        <div>
                            <label for="dispatch-year" class="form-label">‡∏õ‡∏µ ‡∏û.‡∏®.</label>
                            <input type="number" id="dispatch-year" class="form-input" min="2560" max="2580" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="command-count" class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</label>
                            <input type="number" id="command-count" class="form-input" min="0" required>
                        </div>
                        <div>
                            <label for="memo-count" class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                            <input type="number" id="memo-count" class="form-input" min="0" required>
                        </div>
                    </div>
                    <div class="flex justify-end gap-4">
                        <button type="button" id="dispatch-cancel-button" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="dispatch-submit-button" class="btn btn-primary">
                            <div id="dispatch-loader" class="loader hidden"></div>
                            <span>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
        <div id="admin-memo-action-modal" class="modal">
            <div class="modal-content">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
                    <button id="admin-memo-action-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
                </div>
                <form id="admin-memo-action-form">
                    <input type="hidden" id="admin-memo-id">
                    <div class="mb-4">
                        <label for="admin-memo-status" class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="admin-memo-status" class="form-input" required>
                            <option value="‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å)">‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å)</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                            <option value="‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</option>
                            <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                        </select>
                    </div>
                    
                    <div id="admin-file-uploads" class="space-y-4 hidden">
                        <div>
                            <label class="form-label">‡πÑ‡∏ü‡∏•‡πå‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</label>
                            <input type="file" id="admin-completed-memo-file" class="form-input" accept=".pdf,.doc,.docx">
                        </div>
                        <div>
                            <label class="form-label">‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</label>
                            <input type="file" id="admin-completed-command-file" class="form-input" accept=".pdf,.doc,.docx">
                        </div>
                        <div>
                            <label class="form-label">‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</label>
                            <input type="file" id="admin-dispatch-book-file" class="form-input" accept=".pdf,.doc,.docx">
                        </div>
                    </div>
                    
                    <div class="flex justify-end gap-4">
                        <button type="button" id="admin-memo-cancel-button" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" id="admin-memo-submit-button" class="btn btn-primary">
                            <div id="admin-memo-loader" class="loader hidden"></div>
                            <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <!-- Modal ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô -->
        <div id="forgot-password-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold">‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
            <button id="forgot-password-modal-close-button" class="text-gray-500 hover:text-gray-700">&times;</button>
        </div>
        <form id="forgot-password-form">
            <div class="mb-4">
                <label for="forgot-password-email" class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ</label>
                <input type="text" id="forgot-password-email" class="form-input" required>
            </div>
            <div class="flex justify-end gap-4">
                <button type="button" id="forgot-password-cancel-button" class="btn bg-gray-500 text-white">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button type="submit" id="forgot-password-submit-button" class="btn btn-primary">
                    <div id="forgot-password-loader" class="loader hidden"></div>
                    <span>‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</span>
                </button>
            </div>
        </form>
    </div>
            <div id="public-attendee-modal" class="modal">
    <div class="modal-content">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h3 class="text-xl font-bold text-indigo-700">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h3>
            <button id="public-attendee-modal-close-button" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        
        <div class="space-y-4">
            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                <p><strong>‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á/‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:</strong> <span id="public-modal-purpose" class="text-gray-700"></span></p>
                <p class="mt-1"><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="public-modal-location" class="text-gray-700"></span></p>
                <p class="mt-1"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> <span id="public-modal-date" class="text-blue-600 font-bold"></span></p>
            </div>

            <div>
                <h4 class="font-bold text-gray-800 mb-2 border-l-4 border-green-500 pl-2">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</h4>
                <div class="overflow-y-auto max-h-60 border rounded-lg">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th class="px-4 py-2">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                <th class="px-4 py-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="px-4 py-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                            </tr>
                        </thead>
                        <tbody id="public-modal-attendee-list" class="bg-white">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="flex justify-end mt-6">
            <button type="button" id="public-attendee-modal-close-btn2" class="btn bg-gray-500 text-white">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
    </div>
</div>
</div>

    <script>
        // ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á console ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  console.log = function() {};
  console.warn = function() {};
  console.error = function() {};
  console.info = function() {};
        // ‡πÉ‡∏ä‡πâ URL ‡∏Ç‡∏≠‡∏á Google Apps Script
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzP-HCQGbA3Xi2Ms4DXTGy8k17Bv72pFohnJ0txAePjjXybe6pK42mSaYOfTQ5V9Q6mDA/exec";

        // Global State
        let allRequestsCache = [];
        let allMemosCache = [];
        let userMemosCache = [];
        let allUsersCache = [];
        window.requestsChartInstance = null;
        window.statusChartInstance = null;
        let specialPositionMap = {
            '‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ':'‡∏ô‡∏≤‡∏á‡∏ß‡∏ä‡∏¥‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡∏≤ ‡∏û‡∏±‡∏í‡∏ô‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡∏ä',
            '‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•':'‡∏ô‡∏≤‡∏á‡∏õ‡∏ì‡∏¥‡∏ä‡∏≤ ‡∏†‡∏±‡∏™‡∏™‡∏¥‡∏£‡∏≤‡∏Å‡∏∏‡∏•',
            '‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì':'‡∏ô‡∏≤‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏¥‡∏°‡∏≤ ‡∏ô‡∏Å‡∏≠‡∏¢‡∏π‡πà',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£': '‡∏ô‡∏≤‡∏¢‡∏°‡∏á‡∏Ñ‡∏• ‡πÄ‡∏Å‡∏ï‡∏°‡∏ì‡∏µ',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ': '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏¥‡∏¢‡∏£‡∏≤‡∏ä ‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Å‡∏°‡∏•‡∏®‡∏¥‡∏•‡∏õ‡πå',
            '‡∏£‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ':'‡∏ô‡∏≤‡∏¢‡∏≠‡∏≥‡∏ô‡∏≤‡∏à ‡∏ó‡∏±‡∏®‡∏ô‡∏≤',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå': '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏§‡∏ó‡∏ò‡∏¥‡πå ‡∏ä‡∏≤‡∏ç‡∏™‡∏°‡∏£',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢': '‡∏ô‡∏≤‡∏¢‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡∏ß‡∏£‡∏ß‡∏á‡∏Ñ‡πå',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®': '‡∏ô‡∏≤‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏±‡∏Å‡∏©‡πå ‡∏ß‡∏±‡∏í‡∏ô‡∏û‡∏•‡∏≤‡∏ä‡∏±‡∏¢‡∏Å‡∏π‡∏£',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏®‡∏≤‡∏™‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°': '‡∏ô‡∏≤‡∏á‡πÄ‡∏Å‡∏®‡∏£‡∏¥‡∏ô ‡∏ó‡∏≠‡∏á‡πÇ‡∏û‡∏ò‡∏¥‡∏Å‡∏∏‡∏•',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤': '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡πÄ‡∏Å‡∏©‡∏£ ‡πÄ‡∏Ç‡∏à‡∏£‡∏•‡∏≤‡∏†',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏®‡∏¥‡∏•‡∏õ‡∏∞': '‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏õ‡∏¥‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå ‡∏Ç‡∏±‡∏ô‡∏ó‡∏≤',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏ä‡∏µ‡∏û': '‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏™‡∏¥‡∏ô‡∏ó‡∏£',
            '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß':'‡∏ô‡∏≤‡∏¢‡πÄ‡∏£‡∏¥‡∏á‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡∏ô‡∏ß‡∏•',
            '.....................................':'.....................................'
        };

        const statusTranslations = {
            'Pending': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
            'Submitted': '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
            'Approved': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
            'Pending Approval': '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö',
            '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
            '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
            '‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å)': '‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å)',
            '‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç': '‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç',
            '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á',
            '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á',
            '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'
        };

        function translateStatus(status) {
            return statusTranslations[status] || status;
        }

        // --- API HELPER FUNCTIONS ---
        
        async function apiCall(method, action, payload = {}) {
            let url = SCRIPT_URL;
            const options = {
                method: method,
                redirect: 'follow',
                headers: { 'Content-Type': 'text/plain;charset=utf-8', },
            };

            if (method === 'GET') {
                const params = new URLSearchParams({ action, ...payload, cacheBust: new Date().getTime() }); 
                url += `?${params}`;
            } else {
                options.body = JSON.stringify({ action, payload });
            }

            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const result = await response.json();
                if (result.status === 'error') throw new Error(result.message);
                return result;
            } catch (error) {
                console.error('API Call Error:', error);
                
                if (error.message.includes('Failed to fetch')) {
                    showAlert('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï');
                } else {
                    showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', `Server error: ${error.message}`);
                }
                throw error;
            }
        }
        
        // --- UTILITY FUNCTIONS ---
        
        function showAlert(title, message) {
            document.getElementById('alert-modal-title').textContent = title;
            document.getElementById('alert-modal-message').textContent = message;
            document.getElementById('alert-modal').style.display = 'flex';
        }
        
        function showConfirm(title, message) {
            document.getElementById('confirm-modal-title').textContent = title;
            document.getElementById('confirm-modal-message').textContent = message;
            document.getElementById('confirm-modal').style.display = 'flex';

            return new Promise((resolve) => {
                const yesButton = document.getElementById('confirm-modal-yes-button');
                const noButton = document.getElementById('confirm-modal-no-button');
                const onYes = () => { cleanup(); resolve(true); };
                const onNo = () => { cleanup(); resolve(false); };
                
                const cleanup = () => {
                    document.getElementById('confirm-modal').style.display = 'none';
                    yesButton.removeEventListener('click', onYes);
                    noButton.removeEventListener('click', onNo);
                };

                yesButton.addEventListener('click', onYes, { once: true });
                noButton.addEventListener('click', onNo, { once: true });
            });
        }
        
        function toggleLoader(buttonId, show) {
            const button = document.getElementById(buttonId);
            if (!button) {
                console.error(`Button with id '${buttonId}' not found`);
                return;
            }
            
            const loader = button.querySelector('.loader');
            const text = button.querySelector('span');
            
            if (show) {
                if (loader) loader.classList.remove('hidden');
                if (text) text.classList.add('hidden');
                button.disabled = true;
            } else {
                if (loader) loader.classList.add('hidden');
                if (text) text.classList.remove('hidden');
                button.disabled = false;
            }
        }
        
        function getCurrentUser() {
            const userJson = sessionStorage.getItem('currentUser');
            return userJson ? JSON.parse(userJson) : null;
        }

        function fileToObject(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const data = reader.result.toString().split(',')[1];
                    resolve({ filename: file.name, mimeType: file.type, data: data });
                };
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        function formatDisplayDate(dateString) {
            if (!dateString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            try {
                const date = new Date(dateString);
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return date.toLocaleDateString('th-TH', options);
            } catch (e) {
                return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            }
        }

        function clearRequestsCache() {
            allRequestsCache = [];
            allMemosCache = [];
            userMemosCache = [];
        }

        function checkAdminAccess() {
            const user = getCurrentUser();
            return user && user.role === 'admin';
        }

        async function loadSpecialPositions() {
            return new Promise(resolve => {
                console.log('Special positions loaded:', Object.keys(specialPositionMap).length);
                resolve();
            });
        }
        
        // --- PAGE NAVIGATION ---
        
        async function switchPage(targetPageId) {
            console.log("üîÑ Switching to page:", targetPageId);
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤
            document.querySelectorAll('.page-view').forEach(page => {
                page.classList.add('hidden');
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
            const targetPage = document.getElementById(targetPageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
                if(btn.dataset.target === targetPageId) {
                    btn.classList.add('active');
                }
            });

            // ‚úÖ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ event listeners
            if (targetPageId === 'edit-page') {
                setTimeout(() => {
                    setupEditPageEventListeners();
                }, 100);
            }

            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
            if (targetPageId === 'dashboard-page') await fetchUserRequests();
            if (targetPageId === 'form-page') {
                await resetRequestForm();
                setTimeout(() => {
                    tryAutoFillRequester();
                }, 100);
            }
            if (targetPageId === 'profile-page') loadProfileData();
            if (targetPageId === 'stats-page') await loadStatsData();
            if (targetPageId === 'admin-users-page') await fetchAllUsers();
            if (targetPageId === 'command-generation-page') {
                document.getElementById('admin-view-requests-tab').click();
            }
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function resetEditPage() {
            console.log("üßπ Resetting edit page...");
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('edit-request-form').reset();
            document.getElementById('edit-attendees-list').innerHTML = '';
            document.getElementById('edit-result').classList.add('hidden');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
            sessionStorage.removeItem('currentEditRequestId');
            document.getElementById('edit-request-id').value = '';
            document.getElementById('edit-draft-id').value = '';
            
            console.log("‚úÖ Edit page reset complete");
        }

        // --- AUTH FUNCTIONS ---

        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
                return;
            }

            toggleLoader('login-button', true);
            document.getElementById('login-error').classList.add('hidden');
            
            try {
                console.log('Attempting login for:', username);
                const result = await apiCall('POST', 'verifyCredentials', { 
                    username: username, 
                    password: password 
                });
                
                console.log('Login result:', result);
                
                if (result.status === 'success') {
                    sessionStorage.setItem('currentUser', JSON.stringify(result.user));
                    window.currentUser = result.user;
                    initializeUserSession(result.user);
                    showMainApp();
                    await switchPage('dashboard-page');
                    await fetchUserRequests();
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    document.getElementById('login-error').textContent = result.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                    document.getElementById('login-error').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('login-error').textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö: ' + error.message;
                document.getElementById('login-error').classList.remove('hidden');
            } finally {
                toggleLoader('login-button', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô handleForgotPassword
        async function handleForgotPassword(e) {
            e.preventDefault();
            const email = document.getElementById('forgot-password-email').value.trim();
            if (!email) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏ß‡πâ');
                return;
            }

            toggleLoader('forgot-password-submit-button', true);

            try {
                const result = await apiCall('POST', 'forgotPassword', { email });
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß');
                    document.getElementById('forgot-password-modal').style.display = 'none';
                    document.getElementById('forgot-password-form').reset();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                toggleLoader('forgot-password-submit-button', false);
            }
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
        function handleLogout() {
            console.log("üö™ Logging out...");
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
            const navEdit = document.getElementById('nav-edit');
            if (navEdit) {
                navEdit.classList.add('hidden');
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ñ‡πâ‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
            document.getElementById('edit-page').classList.add('hidden');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• session
            sessionStorage.removeItem('currentUser');
            sessionStorage.removeItem('currentEditRequestId');
            window.currentUser = null;
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            showLoginScreen();
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('login-form').reset();
            
            console.log("‚úÖ Logout completed");
        }

     async function handleRegister(e) {
    e.preventDefault();
    
    const formData = {
        username: document.getElementById('register-username').value.trim(),
        password: document.getElementById('register-password').value,
        fullName: document.getElementById('register-fullname').value.trim(),
        position: document.getElementById('register-position').value.trim(),
        department: document.getElementById('register-department').value.trim(),
        email: document.getElementById('register-email').value.trim(),
        role: 'user'
    };

    if (!formData.username || !formData.password || !formData.fullName) {
        showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
    }

    toggleLoader('register-submit-button', true);

    try {
        const result = await apiCall('POST', 'registerUser', formData);
        
        if (result.status === 'success') {
            showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö');
            document.getElementById('register-modal').style.display = 'none';
            document.getElementById('register-form').reset();
        } else {
            showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
        }
    } catch (error) {
        showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ' + error.message);
    } finally {
        toggleLoader('register-submit-button', false);
    }
}
        // --- INITIALIZATION ---
        
        function initializeUserSession(user) {
            updateUIForUser(user);
            showMainApp();
            switchPage('dashboard-page');
        }

        function updateUIForUser(user) {
            document.getElementById('user-fullname').textContent = user.fullName || 'N/A';
            document.getElementById('user-position').textContent = user.position || 'N/A';

            const isAdmin = user.role === 'admin';
            document.getElementById('admin-nav-command').classList.toggle('hidden', !isAdmin);
            document.getElementById('admin-nav-users').classList.toggle('hidden', !isAdmin);
        }
        
        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }
        
        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
        function showLoginScreen() {
            console.log("üîê Showing login screen");
            
            // ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞ state
            resetEditPage();
            
            // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            document.querySelectorAll('.page-view').forEach(page => {
                page.classList.add('hidden');
            });
            
            document.getElementById('edit-page').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            
            // ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏≥‡∏ó‡∏≤‡∏á
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏õ‡πá‡∏ô default
            document.getElementById('user-nav-dashboard').classList.add('active');
            
            // ‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• session
            sessionStorage.removeItem('currentUser');
            sessionStorage.removeItem('currentEditRequestId');
            window.currentUser = null;
            
            // ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
            document.getElementById('login-form').reset();
            document.getElementById('login-error').classList.add('hidden');
            
            console.log("‚úÖ Login screen ready");
        }

        // --- EVENT LISTENER SETUP ---

        function setupEventListeners() {
            // Auth
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-button').addEventListener('click', handleLogout);
            document.getElementById('show-register-modal-button').addEventListener('click', () => document.getElementById('register-modal').style.display = 'flex');
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            
            // ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô
            document.getElementById('show-forgot-password-modal').addEventListener('click', () => {
                document.getElementById('forgot-password-modal').style.display = 'flex';
            });
            document.getElementById('forgot-password-modal-close-button').addEventListener('click', () => {
                document.getElementById('forgot-password-modal').style.display = 'none';
            });
            document.getElementById('forgot-password-cancel-button').addEventListener('click', () => {
                document.getElementById('forgot-password-modal').style.display = 'none';
            });
            document.getElementById('forgot-password-form').addEventListener('submit', handleForgotPassword);
            // Modal ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (Public)
            document.getElementById('public-attendee-modal-close-button').addEventListener('click', () => {
                document.getElementById('public-attendee-modal').style.display = 'none';
            });
            document.getElementById('public-attendee-modal-close-btn2').addEventListener('click', () => {
                document.getElementById('public-attendee-modal').style.display = 'none';
            });
            // Navigation
            document.getElementById('back-to-admin-command').addEventListener('click', async () => {
                await switchPage('command-generation-page');
            });
            
            document.getElementById('admin-generate-command-button').addEventListener('click', handleAdminGenerateCommand);
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
            setupVehicleOptions();

            // Stats page events
            document.getElementById('refresh-stats').addEventListener('click', async () => {
                await loadStatsData();
                showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            });

            document.getElementById('export-stats').addEventListener('click', exportStatsReport);

            // Navigation
            document.getElementById('navigation').addEventListener('click', async (e) => {
                const navButton = e.target.closest('.nav-button');
                if (navButton && navButton.dataset.target) {
                    await switchPage(navButton.dataset.target);
                }
            });

            // Modals
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.style.display = 'none';
                });
            });
            
            document.getElementById('register-modal-close-button').addEventListener('click', () => document.getElementById('register-modal').style.display = 'none');
            document.getElementById('register-modal-close-button2').addEventListener('click', () => document.getElementById('register-modal').style.display = 'none');
            document.getElementById('alert-modal-close-button').addEventListener('click', () => document.getElementById('alert-modal').style.display = 'none');
            document.getElementById('alert-modal-ok-button').addEventListener('click', () => document.getElementById('alert-modal').style.display = 'none');
            document.getElementById('confirm-modal-close-button').addEventListener('click', () => document.getElementById('confirm-modal').style.display = 'none');
            document.getElementById('send-memo-modal-close-button').addEventListener('click', () => document.getElementById('send-memo-modal').style.display = 'none');
            document.getElementById('send-memo-cancel-button').addEventListener('click', () => document.getElementById('send-memo-modal').style.display = 'none');

            // Modal Event Listeners ‡πÉ‡∏´‡∏°‡πà
            document.getElementById('command-approval-form').addEventListener('submit', handleCommandApproval);
            document.getElementById('command-approval-modal-close-button').addEventListener('click', () => document.getElementById('command-approval-modal').style.display = 'none');
            document.getElementById('command-approval-cancel-button').addEventListener('click', () => document.getElementById('command-approval-modal').style.display = 'none');
            
            document.getElementById('dispatch-form').addEventListener('submit', handleDispatchFormSubmit);
            document.getElementById('dispatch-modal-close-button').addEventListener('click', () => document.getElementById('dispatch-modal').style.display = 'none');
            document.getElementById('dispatch-cancel-button').addEventListener('click', () => document.getElementById('dispatch-modal').style.display = 'none');
            
            document.getElementById('admin-memo-action-form').addEventListener('submit', handleAdminMemoActionSubmit);
            document.getElementById('admin-memo-action-modal-close-button').addEventListener('click', () => document.getElementById('admin-memo-action-modal').style.display = 'none');
            document.getElementById('admin-memo-cancel-button').addEventListener('click', () => document.getElementById('admin-memo-action-modal').style.display = 'none');
            
            // Event listener‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
            document.getElementById('admin-memo-status').addEventListener('change', function(e) {
                const fileUploads = document.getElementById('admin-file-uploads');
                if (e.target.value === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô') {
                    fileUploads.classList.remove('hidden');
                } else {
                    fileUploads.classList.add('hidden');
                }
            });

            // Forms
            document.getElementById('request-form').addEventListener('submit', handleRequestFormSubmit);
            document.getElementById('form-add-attendee').addEventListener('click', () => addAttendeeField());
            document.getElementById('form-import-excel').addEventListener('click', () => document.getElementById('excel-file-input').click());
            document.getElementById('excel-file-input').addEventListener('change', handleExcelImport);
            document.getElementById('form-download-template').addEventListener('click', downloadAttendeeTemplate);
            document.querySelectorAll('input[name="expense_option"]').forEach(radio => radio.addEventListener('change', toggleExpenseOptions));
            
            document.getElementById('send-memo-form').addEventListener('submit', handleMemoSubmitFromModal);
            document.querySelectorAll('input[name="modal_memo_type"]').forEach(radio => radio.addEventListener('change', (e) => {
                const fileContainer = document.getElementById('modal-memo-file-container');
                const fileInput = document.getElementById('modal-memo-file');
                const isReimburse = e.target.value === 'reimburse';
                fileContainer.classList.toggle('hidden', isReimburse);
                fileInput.required = !isReimburse;
            }));
            document.querySelectorAll('input[name="vehicle_option"]').forEach(checkbox => {checkbox.addEventListener('change', toggleVehicleDetails);});
            document.getElementById('profile-form').addEventListener('submit', handleProfileUpdate);
            document.getElementById('password-form').addEventListener('submit', handlePasswordUpdate);
            document.getElementById('show-password-toggle').addEventListener('change', togglePasswordVisibility);
            
            document.getElementById('form-department').addEventListener('change', (e) => {
                const selectedPosition = e.target.value;
                const headNameInput = document.getElementById('form-head-name');
                headNameInput.value = specialPositionMap[selectedPosition] || '';
            });
            
            // Search
            document.getElementById('search-requests').addEventListener('input', (e) => renderRequestsList(allRequestsCache, userMemosCache, e.target.value));

            // Admin
            document.getElementById('add-user-button').addEventListener('click', openAddUserModal);
            document.getElementById('download-user-template-button').addEventListener('click', downloadUserTemplate);
            document.getElementById('import-users-button').addEventListener('click', () => document.getElementById('user-excel-input').click());
            document.getElementById('user-excel-input').addEventListener('change', handleUserImport);
            
            // Admin Page Tabs
            document.getElementById('admin-view-requests-tab').addEventListener('click', async (e) => {
                document.getElementById('admin-view-memos-tab').classList.remove('active');
                e.target.classList.add('active');
                document.getElementById('admin-requests-view').classList.remove('hidden');
                document.getElementById('admin-memos-view').classList.add('hidden');
                await fetchAllRequestsForCommand();
            });
            
            document.getElementById('admin-view-memos-tab').addEventListener('click', async (e) => {
                document.getElementById('admin-view-requests-tab').classList.remove('active');
                e.target.classList.add('active');
                document.getElementById('admin-memos-view').classList.remove('hidden');
                document.getElementById('admin-requests-view').classList.add('hidden');
                await fetchAllMemos();
            });

            // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Global Error Handler ‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
            window.addEventListener('error', (event) => {
                console.error('Global error:', event.error);
                
                // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô error ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πàÂ≠òÂú®ÁöÑ
                if (event.error.message && event.error.message.includes('openEditPageDirect')) {
                    console.warn('Ignoring openEditPageDirect error - function no longer exists');
                    return; // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á alert ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö error ‡∏ô‡∏µ‡πâ
                }
                
                showAlert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏ö‡∏ö", "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö");
            });

            window.addEventListener('unhandledrejection', (event) => {
                console.error('Unhandled promise rejection:', event.reason);
                
                // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô rejection ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πàÂ≠òÂú®ÁöÑ
                if (event.reason && event.reason.message && event.reason.message.includes('openEditPageDirect')) {
                    console.warn('Ignoring openEditPageDirect promise rejection');
                    return;
                }
                
                showAlert("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡∏∞‡∏ö‡∏ö", "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö");
            });
        }

        // --- EDIT PAGE FUNCTIONS ---

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô setupEditPageEventListeners
        function setupEditPageEventListeners() {
            // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î - ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö navigation
            document.getElementById('back-to-dashboard').addEventListener('click', () => {
                console.log("üè† Returning to dashboard from edit page");
                switchPage('dashboard-page');
            });
            
            // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            document.getElementById('generate-document-button').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("Generate document button clicked");
                generateDocumentFromDraft();
            });
            
            // ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
            document.getElementById('edit-add-attendee').addEventListener('click', () => addEditAttendeeField());
            
            // ‚úÖ Expense options
            document.querySelectorAll('input[name="edit-expense_option"]').forEach(radio => {
                radio.addEventListener('change', toggleEditExpenseOptions);
            });
            
            // ‚úÖ Vehicle options
            document.querySelectorAll('input[name="edit-vehicle_option"]').forEach(radio => {
                radio.addEventListener('change', toggleEditVehicleOptions);
            });
            
            // ‚úÖ Department change
            document.getElementById('edit-department').addEventListener('change', (e) => {
                const selectedPosition = e.target.value;
                const headNameInput = document.getElementById('edit-head-name');
                headNameInput.value = specialPositionMap[selectedPosition] || '';
            });
        }

        // --- REQUEST FUNCTIONS ---

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç handleRequestAction ‡πÄ‡∏õ‡πá‡∏ô async function
        async function handleRequestAction(e) {
            const button = e.target.closest('button[data-action]');
            if (!button) return;

            const requestId = button.dataset.id;
            const action = button.dataset.action;
            const user = getCurrentUser();

            console.log("Action triggered:", action, "Request ID:", requestId);

            if (action === 'edit') {
                console.log("üîÑ Opening edit page for:", requestId);
                await openEditPage(requestId);
                
            } else if (action === 'delete') {
                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠
                console.log("üóëÔ∏è Deleting request:", requestId);
                await handleDeleteRequest(requestId);
                
            } else if (action === 'send-memo') {
                // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                console.log("üì§ Opening send memo modal for:", requestId);
                document.getElementById('memo-modal-request-id').value = requestId;
                document.getElementById('send-memo-modal').style.display = 'flex';
            }
        }

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô async)
        async function handleDeleteRequest(requestId) {
            try {
                const user = getCurrentUser();
                if (!user) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà');
                    return;
                }

                // ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
                const confirmed = await showConfirm(
                    '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 
                    `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${requestId}? ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`
                );

                if (!confirmed) {
                    console.log("User cancelled deletion");
                    return;
                }

                console.log("Deleting request:", requestId, "by user:", user.username);

                // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠
                const result = await apiCall('POST', 'deleteRequest', {
                    requestId: requestId,
                    username: user.username
                });

                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    
                    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï cache ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏´‡∏°‡πà
                    clearRequestsCache();
                    await fetchUserRequests();
                    
                    // ‚úÖ ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    if (document.getElementById('edit-page').classList.contains('hidden') === false) {
                        await switchPage('dashboard-page');
                    }
                    
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ');
                }

            } catch (error) {
                console.error('Error deleting request:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠: ' + error.message);
            }
        }

        // --- ADMIN FUNCTIONS ---

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchAllRequestsForCommand ‡πÄ‡∏õ‡πá‡∏ô async
        async function fetchAllRequestsForCommand() {
            try {
                if (!checkAdminAccess()) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                    return;
                }

                const result = await apiCall('GET', 'getAllRequests');
                if (result.status === 'success') {
                    renderAdminRequestsList(result.data);
                }
            } catch (error) {
                console.error('Error fetching requests for command:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ');
            }
        }

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchAllMemos ‡πÄ‡∏õ‡πá‡∏ô async
        async function fetchAllMemos() {
            try {
                if (!checkAdminAccess()) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                    return;
                }

                const result = await apiCall('GET', 'getAllMemos');
                if (result.status === 'success') {
                    renderAdminMemosList(result.data);
                }
            } catch (error) {
                console.error('Error fetching memos:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ');
            }
        }

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchAllUsers ‡πÄ‡∏õ‡πá‡∏ô async
        async function fetchAllUsers() {
            try {
                if (!checkAdminAccess()) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ');
                    return;
                }

                const result = await apiCall('GET', 'getAllUsers');
                if (result.status === 'success') {
                    allUsersCache = result.data;
                    renderUsersList(allUsersCache);
                }
            } catch (error) {
                console.error('Error fetching users:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ');
            }
        }

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchUserRequests ‡πÄ‡∏õ‡πá‡∏ô async
        async function fetchUserRequests() {
            try {
                const user = getCurrentUser();
                if (!user) return;

                document.getElementById('requests-loader').classList.remove('hidden');
                document.getElementById('requests-list').classList.add('hidden');
                document.getElementById('no-requests-message').classList.add('hidden');

                // ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á Requests ‡πÅ‡∏•‡∏∞ Memos ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                const [requestsResult, memosResult] = await Promise.all([
                    apiCall('GET', 'getUserRequests', { username: user.username }),
                    apiCall('GET', 'getSentMemos', { username: user.username })
                ]);
                
                if (requestsResult.status === 'success') {
                    allRequestsCache = requestsResult.data;
                    userMemosCache = memosResult.data || [];
                    renderRequestsList(allRequestsCache, userMemosCache);
                }
            } catch (error) {
                console.error('Error fetching requests:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ');
            } finally {
                document.getElementById('requests-loader').classList.add('hidden');
            }
        }

        // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô openAdminGenerateCommand ‡πÄ‡∏õ‡πá‡∏ô async
        async function openAdminGenerateCommand(requestId) {
            try {
                if (!checkAdminAccess()) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                    return;
                }
                document.getElementById('admin-command-result').classList.add('hidden');
                document.getElementById('admin-command-form').classList.remove('hidden');

                console.log("‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:", requestId);
                
                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠
                const result = await apiCall('GET', 'getDraftRequest', { requestId: requestId });
                
                if (result.status === 'success' && result.data) {
                    const requestData = result.data;
                    
                    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('admin-command-request-id').value = requestId;
                    document.getElementById('admin-command-request-id-display').textContent = requestData.id || requestId;
                    document.getElementById('admin-command-doc-date-display').textContent = formatDisplayDate(requestData.docDate);
                    document.getElementById('admin-command-requester-name').textContent = requestData.requesterName || '';
                    document.getElementById('admin-command-requester-position').textContent = requestData.requesterPosition || '';
                    document.getElementById('admin-command-location').textContent = requestData.location || '';
                    document.getElementById('admin-command-purpose').textContent = requestData.purpose || '';
                    document.getElementById('admin-command-start-date').textContent = formatDisplayDate(requestData.startDate);
                    document.getElementById('admin-command-end-date').textContent = formatDisplayDate(requestData.endDate);
                    
                    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                    const attendeesList = document.getElementById('admin-command-attendees-list');
                    attendeesList.innerHTML = '';
                    
                    if (requestData.attendees && requestData.attendees.length > 0) {
                        requestData.attendees.forEach(attendee => {
                            const attendeeDiv = document.createElement('div');
                            attendeeDiv.className = 'border-b pb-2 mb-2';
                            attendeeDiv.innerHTML = `
                                <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${attendee.name}</p>
                                <p><strong>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á:</strong> ${attendee.position}</p>
                            `;
                            attendeesList.appendChild(attendeeDiv);
                        });
                    } else {
                        attendeesList.innerHTML = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</p>';
                    }
                    
                    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                    const expenseInfo = document.getElementById('admin-command-expense-info');
                    if (requestData.expenseOption === 'partial' && requestData.expenseItems && requestData.expenseItems.length > 0) {
                        const expenseItems = Array.isArray(requestData.expenseItems) ? 
                            requestData.expenseItems : 
                            JSON.parse(requestData.expenseItems || '[]');
                        
                        let expenseHtml = '<p><strong>‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢:</strong> ‡πÉ‡∏ä‡πà</p><ul class="list-disc pl-5 mt-2">';
                        expenseItems.forEach(item => {
                            expenseHtml += `<li>${item.name}${item.detail ? ` (${item.detail})` : ''}</li>`;
                        });
                        expenseHtml += `</ul><p class="mt-2"><strong>‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${requestData.totalExpense || 0} ‡∏ö‡∏≤‡∏ó</p>`;
                        expenseInfo.innerHTML = expenseHtml;
                    } else {
                        expenseInfo.innerHTML = '<p><strong>‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢:</strong> ‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏¥‡∏Å</p>';
                    }
                    
                    // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                    const vehicleInfo = document.getElementById('admin-command-vehicle-info');
                    let vehicleHtml = '';
                    
                    if (requestData.vehicleOption) {
                        const vehicleOptions = Array.isArray(requestData.vehicleOption) ? 
                            requestData.vehicleOption : 
                            [requestData.vehicleOption];
                        
                        vehicleOptions.forEach(option => {
                            switch(option) {
                                case 'gov':
                                    vehicleHtml += '<p>‚úì ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (‡∏£‡∏ñ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</p>';
                                    break;
                                case 'private':
                                    vehicleHtml += `<p>‚úì ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß${requestData.licensePlate ? ` (‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô: ${requestData.licensePlate})` : ''}</p>`;
                                    break;
                                case 'public':
                                    vehicleHtml += `<p>‚úì ‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ${requestData.publicVehicleDetails ? ` (${requestData.publicVehicleDetails})` : ''}</p>`;
                                    break;
                            }
                        });
                    } else {
                        vehicleHtml = '<p class="text-gray-500">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</p>';
                    }
                    
                    vehicleInfo.innerHTML = vehicleHtml;
                    
                    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
                    await switchPage('admin-generate-command-page');
                    
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Error opening admin generate command page:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            }
        }

        // --- EDIT PAGE FUNCTIONS ---

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç - ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        async function populateEditForm(requestData) {
            try {
                console.log("Populating edit form with:", requestData);
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
                document.getElementById('edit-draft-id').value = requestData.draftId || '';
                document.getElementById('edit-request-id').value = requestData.requestId || requestData.id || '';
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ format
                const formatDateForInput = (dateValue) => {
                    if (!dateValue) return '';
                    try {
                        const date = new Date(dateValue);
                        if (isNaN(date)) return '';
                        return date.toISOString().split('T')[0];
                    } catch (e) {
                        return '';
                    }
                };
                
                document.getElementById('edit-doc-date').value = formatDateForInput(requestData.docDate);
                document.getElementById('edit-requester-name').value = requestData.requesterName || '';
                document.getElementById('edit-requester-position').value = requestData.requesterPosition || '';
                document.getElementById('edit-location').value = requestData.location || '';
                document.getElementById('edit-purpose').value = requestData.purpose || '';
                document.getElementById('edit-start-date').value = formatDateForInput(requestData.startDate);
                document.getElementById('edit-end-date').value = formatDateForInput(requestData.endDate);
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                const attendeesList = document.getElementById('edit-attendees-list');
                attendeesList.innerHTML = '';
                
                if (requestData.attendees && requestData.attendees.length > 0) {
                    requestData.attendees.forEach((attendee, index) => {
                        if (attendee.name && attendee.position) {
                            addEditAttendeeField(attendee.name, attendee.position);
                        }
                    });
                }
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                if (requestData.expenseOption === 'partial') {
                    document.getElementById('edit-expense_partial').checked = true;
                    toggleEditExpenseOptions();
                    
                    if (requestData.expenseItems && requestData.expenseItems.length > 0) {
                        const expenseItems = Array.isArray(requestData.expenseItems) ? 
                            requestData.expenseItems : 
                            JSON.parse(requestData.expenseItems || '[]');
                            
                        expenseItems.forEach(item => {
                            const checkboxes = document.querySelectorAll('input[name="edit-expense_item"]');
                            checkboxes.forEach(chk => {
                                if (chk.dataset.itemName === item.name) {
                                    chk.checked = true;
                                    if (item.name === '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ' && item.detail) {
                                        document.getElementById('edit-expense_other_text').value = item.detail;
                                    }
                                }
                            });
                        });
                    }
                    
                    if (requestData.totalExpense) {
                        document.getElementById('edit-total-expense').value = requestData.totalExpense;
                    }
                } else {
                    document.getElementById('edit-expense_no').checked = true;
                    toggleEditExpenseOptions();
                }
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
                if (requestData.vehicleOption) {
                    const vehicleRadio = document.getElementById(`edit-vehicle_${requestData.vehicleOption}`);
                    if (vehicleRadio) {
                        vehicleRadio.checked = true;
                        toggleEditVehicleOptions();
                        
                        if (requestData.vehicleOption === 'private' && requestData.licensePlate) {
                            document.getElementById('edit-license-plate').value = requestData.licensePlate;
                        }
                    }
                }
                
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°
                if (requestData.department) {
                    document.getElementById('edit-department').value = requestData.department;
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤‡∏° department
                    const headNameInput = document.getElementById('edit-head-name');
                    headNameInput.value = specialPositionMap[requestData.department] || '';
                }
                
                if (requestData.headName) {
                    document.getElementById('edit-head-name').value = requestData.headName;
                }
                
                console.log("Edit form populated successfully");
                
            } catch (error) {
                console.error("Error populating edit form:", error);
                throw error;
            }
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç - ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        async function openEditPage(requestId) {
            try {
                console.log("üîì Opening edit page for request:", requestId);

                // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
                if (!requestId || requestId === 'undefined' || requestId === 'null') {
                    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠");
                    return;
                }

                // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                const user = getCurrentUser();
                if (!user) {
                    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà");
                    return;
                }

                const username = user.username;
                
                console.log("üì° Calling API with:", { requestId, username });

                // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á loading state
                document.getElementById('edit-result').classList.add('hidden');
                document.getElementById('edit-attendees-list').innerHTML = `
                    <div class="text-center p-4">
                        <div class="loader mx-auto"></div>
                        <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                    </div>`;

                // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const result = await apiCall('GET', 'getDraftRequest', { 
                    requestId: requestId, 
                    username: username 
                });

                console.log("üî• Raw API Response:", result);

                // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                if (result.status === 'success' && result.data) {
                    let data = result.data;
                    
                    // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö nesting ‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    if (result.data && result.data.data) {
                        data = result.data.data;
                        console.log("üîÑ Found nested data structure, using result.data.data");
                    }
                    
                    // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô data ‡∏°‡∏µ status error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (data.status === 'error') {
                        console.error("‚ùå Error in data:", data.message);
                        showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", data.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                        return;
                    }
                    
                    console.log("‚úÖ Data received successfully from server");
                    console.log("üîç Processed data:", data);

                    // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                    if (!data || Object.keys(data).length === 0) {
                        console.warn("‚ö†Ô∏è Empty data received");
                        showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°");
                        return;
                    }

                    // ‚úÖ ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô attendees undefined
                    data.attendees = Array.isArray(data.attendees) ? data.attendees : [];

                    // ‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å currentUser ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å server ‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
                    if ((!data.requesterName || data.requesterName.trim() === '') && user?.fullName) {
                        data.requesterName = user.fullName;
                        console.log("üë§ Filled requesterName from user profile:", data.requesterName);
                    }
                    if ((!data.requesterPosition || data.requesterPosition.trim() === '') && user?.position) {
                        data.requesterPosition = user.position;
                        console.log("üë§ Filled requesterPosition from user profile:", data.requesterPosition);
                    }

                    // ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö requestId ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                    sessionStorage.setItem('currentEditRequestId', requestId);

                    // ‚úÖ ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    await populateEditForm(data);

                    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ó‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á requesterName / requesterPosition ‡∏≠‡∏µ‡∏Å‡∏ä‡∏±‡πâ‡∏ô
                    const inputRequesterName = document.getElementById('edit-requester-name');
                    const inputRequesterPosition = document.getElementById('edit-requester-position');
                    if (inputRequesterName && data.requesterName) inputRequesterName.value = data.requesterName;
                    if (inputRequesterPosition && data.requesterPosition) inputRequesterPosition.value = data.requesterPosition;

                    // ‚úÖ ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö navigation ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
                    switchPage('edit-page');
                    
                    console.log("‚úÖ Edit page opened successfully with requestId:", requestId);
                    
                } else {
                    // ‚úÖ ‡∏Å‡∏£‡∏ì‡∏µ result.status !== 'success' ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ data
                    console.error("‚ùå API returned error:", result.message || "No data received");
                    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", result.message || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ");
                }

            } catch (error) {
                console.error("‚ùå Error loading edit data:", error);
                showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ: " + error.message);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function addEditAttendeeField(name = '', position = '') {
            const list = document.getElementById('edit-attendees-list');
            const attendeeDiv = document.createElement('div');
            attendeeDiv.className = 'grid grid-cols-1 md:grid-cols-3 gap-2 items-center mb-2';
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö options ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const isStandardPosition = ['‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£', '‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£', '‡∏Ñ‡∏£‡∏π', '‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£', '‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á', '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ', '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'].includes(position);
            const selectValue = isStandardPosition ? position : (position ? 'other' : '');
            
            attendeeDiv.innerHTML = `
                <input type="text" class="form-input attendee-name md:col-span-1" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" value="${name}" required>
                <div class="attendee-position-wrapper md:col-span-1">
                    <select class="form-input attendee-position-select">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                        <option value="‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á">‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                        <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
                    </select>
                    <input type="text" class="form-input attendee-position-other hidden mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" value="${!isStandardPosition && position ? position : ''}">
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">‡∏•‡∏ö</button>
            `;
            list.appendChild(attendeeDiv);
            
            const select = attendeeDiv.querySelector('.attendee-position-select');
            const otherInput = attendeeDiv.querySelector('.attendee-position-other');

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            if (selectValue) {
                select.value = selectValue;
                if (selectValue === 'other') {
                    otherInput.classList.remove('hidden');
                }
            }

            select.addEventListener('change', () => {
                otherInput.classList.toggle('hidden', select.value !== 'other');
                if (select.value !== 'other') {
                    otherInput.value = '';
                }
            });
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô toggle ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function toggleEditExpenseOptions() {
            const partialOptions = document.getElementById('edit-partial-expense-options');
            const totalContainer = document.getElementById('edit-total-expense-container');
            
            if (document.getElementById('edit-expense_partial')?.checked) {
                partialOptions.classList.remove('hidden');
                totalContainer.classList.remove('hidden');
            } else {
                partialOptions.classList.add('hidden');
                totalContainer.classList.add('hidden');
                
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
                document.querySelectorAll('input[name="edit-expense_item"]').forEach(chk => {
                    chk.checked = false;
                });
                document.getElementById('edit-expense_other_text').value = '';
                document.getElementById('edit-total-expense').value = '';
            }
        }

        function toggleEditVehicleOptions() {
            const privateDetails = document.getElementById('edit-private-vehicle-details');
            
            if (document.getElementById('edit-vehicle_private')?.checked) {
                privateDetails.classList.remove('hidden');
            } else {
                privateDetails.classList.add('hidden');
                document.getElementById('edit-license-plate').value = '';
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        async function generateDocumentFromDraft() {
            console.log("=== generateDocumentFromDraft START ===");
            
            // üîß **‡∏î‡∏∂‡∏á requestId ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á**
            let requestId = document.getElementById('edit-request-id').value;
            const draftId = document.getElementById('edit-draft-id').value;
            
            if (!requestId) {
                requestId = sessionStorage.getItem('currentEditRequestId');
                if (requestId) {
                    document.getElementById('edit-request-id').value = requestId;
                    console.log("Retrieved requestId from sessionStorage:", requestId);
                }
            }
            
            console.log("Final requestId:", requestId, "draftId:", draftId);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ requestId
            if (!requestId) {
                showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà");
                return;
            }

            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
            const formData = getEditFormData();
            if (!formData) {
                return; // getEditFormData ‡πÅ‡∏™‡∏î‡∏á error ‡πÅ‡∏•‡πâ‡∏ß
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            if (!validateEditForm(formData)) {
                return;
            }
            
            // üîß **‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ requestId ‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á**
            formData.requestId = requestId;
            formData.draftId = draftId;
            formData.isEdit = true;
            
            console.log("Sending data to server:", formData);
            
            toggleLoader('generate-document-button', true);
            
            try {
                // üîß **‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ API ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô**
                let result;
                
                // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ updateRequest ‡∏Å‡πà‡∏≠‡∏ô
                try {
                    result = await apiCall('POST', 'updateRequest', formData);
                    console.log("updateRequest result:", result);
                } catch (updateError) {
                    console.log("updateRequest failed, trying createRequest with isEdit flag:", updateError);
                    // ‡∏ñ‡πâ‡∏≤ updateRequest ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ createRequest ‡∏û‡∏£‡πâ‡∏≠‡∏° flag isEdit
                    result = await apiCall('POST', 'createRequest', formData);
                    console.log("createRequest with isEdit result:", result);
                }
                
                if (result.status === 'success') {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    document.getElementById('edit-result-title').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                    document.getElementById('edit-result-message').textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ó‡∏µ‡πà ${result.data.id || requestId} ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß`;
                    
                    if (result.data.pdfUrl) {
        document.getElementById('edit-result-link').href = result.data.pdfUrl;
        document.getElementById('edit-result-link').classList.remove('hidden');
    } else {
        document.getElementById('edit-result-link').classList.add('hidden');
        document.getElementById('edit-result-message').textContent += ' (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ)';
    }
    
    document.getElementById('edit-result').classList.remove('hidden');
    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï cache ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    clearRequestsCache();
    await fetchUserRequests();
                    
                    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                    sessionStorage.removeItem('currentEditRequestId');
    
    showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    
} else {
    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", result.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ");
}
            } catch (error) {
                console.error("Error updating document:", error);
                showAlert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ: " + error.message);
            } finally {
                toggleLoader('generate-document-button', false);
            }
            
            console.log("=== generateDocumentFromDraft END ===");
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function getEditFormData() {
            try {
                // üîß **‡∏î‡∏∂‡∏á requestId ‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô**
                let requestId = document.getElementById('edit-request-id').value;
                const draftId = document.getElementById('edit-draft-id').value;
                
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏à‡∏≤‡∏Å input field ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å sessionStorage
                if (!requestId) {
                    requestId = sessionStorage.getItem('currentEditRequestId');
                    if (requestId) {
                        document.getElementById('edit-request-id').value = requestId;
                    }
                }
                
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å URL parameter (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                if (!requestId) {
                    const urlParams = new URLSearchParams(window.location.search);
                    requestId = urlParams.get('requestId');
                }
                
                console.log("Getting edit form data - Request ID:", requestId, "Draft ID:", draftId);
                
                if (!requestId && !draftId) {
                    console.error("No requestId or draftId found!");
                    showAlert("‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
                    return null;
                }

                const expenseItems = [];
                const expenseOption = document.querySelector('input[name="edit-expense_option"]:checked');
                
                if (expenseOption && expenseOption.value === 'partial') {
                    document.querySelectorAll('input[name="edit-expense_item"]:checked').forEach(chk => {
                        const item = { name: chk.dataset.itemName };
                        if (item.name === '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                            item.detail = document.getElementById('edit-expense_other_text').value.trim();
                        }
                        expenseItems.push(item);
                    });
                }

                const attendees = Array.from(document.querySelectorAll('#edit-attendees-list > div')).map(div => {
                    const nameInput = div.querySelector('.attendee-name');
                    const select = div.querySelector('.attendee-position-select');
                    let position = select ? select.value : '';
                    
                    if (position === 'other') {
                        const otherInput = div.querySelector('.attendee-position-other');
                        position = otherInput ? otherInput.value.trim() : '';
                    }
                    
                    return {
                        name: nameInput ? nameInput.value.trim() : '',
                        position: position
                    };
                }).filter(att => att.name && att.position);

                const user = getCurrentUser();
                if (!user) {
                    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà");
                    return null;
                }

                const formData = {
                    draftId: draftId || '',
                    requestId: requestId || '',
                    username: user.username,
                    docDate: document.getElementById('edit-doc-date').value,
                    requesterName: document.getElementById('edit-requester-name').value.trim(),
                    requesterPosition: document.getElementById('edit-requester-position').value.trim(),
                    location: document.getElementById('edit-location').value.trim(),
                    purpose: document.getElementById('edit-purpose').value.trim(),
                    startDate: document.getElementById('edit-start-date').value,
                    endDate: document.getElementById('edit-end-date').value,
                    attendees: attendees,
                    expenseOption: expenseOption ? expenseOption.value : 'no',
                    expenseItems: expenseItems,
                    totalExpense: document.getElementById('edit-total-expense').value || 0,
                    vehicleOption: document.querySelector('input[name="edit-vehicle_option"]:checked')?.value || 'gov',
                    licensePlate: document.getElementById('edit-license-plate').value.trim(),
                    department: document.getElementById('edit-department').value,
                    headName: document.getElementById('edit-head-name').value,
                    isEdit: true // üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏™‡∏°‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                };

                console.log("Edit form data prepared:", formData);
                return formData;
                
            } catch (error) {
                console.error("Error in getEditFormData:", error);
                showAlert("‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ");
                return null;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô validation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function validateEditForm(formData) {
            console.log("Validating edit form:", formData);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            if (!formData.docDate) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");
                return false;
            }
            
            if (!formData.requesterName || !formData.requesterPosition) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≠");
                return false;
            }
            
            if (!formData.location) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£");
                return false;
            }
            
            if (!formData.purpose) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå");
                return false;
            }
            
            if (!formData.startDate || !formData.endDate) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
                return false;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
            const startDate = new Date(formData.startDate);
            const endDate = new Date(formData.endDate);
            
            if (startDate > endDate) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î");
                return false;
            }
            
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ requestId ‡∏´‡∏£‡∏∑‡∏≠ draftId
            if (formData.isEdit && !formData.requestId && !formData.draftId) {
                showAlert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç");
                return false;
            }
            
            console.log("Edit form validation passed");
            return true;
        }

        // --- PROFILE FUNCTIONS ---

        function loadProfileData() {
            const user = getCurrentUser();
            if (!user) return;

            document.getElementById('profile-fullname').value = user.fullName || '';
            document.getElementById('profile-position').value = user.position || '';
            document.getElementById('profile-department').value = user.department || '';
            document.getElementById('profile-email').value = user.email || '';
            document.getElementById('profile-username').value = user.username || '';
            document.getElementById('profile-loginname').value = user.loginName || '';
        }

        async function handleProfileUpdate(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            if (!user) return;

            const formData = {
                username: user.username,
                loginName: document.getElementById('profile-loginname').value.trim(),
                fullName: document.getElementById('profile-fullname').value,
                position: document.getElementById('profile-position').value,
                department: document.getElementById('profile-department').value,
                email: document.getElementById('profile-email').value
            };

            toggleLoader('profile-submit-button', true);

            try {
                const result = await apiCall('POST', 'updateUserProfile', formData);
                
                if (result.status === 'success') {
                    const updatedUser = { ...user, ...formData };
                    sessionStorage.setItem('currentUser', JSON.stringify(updatedUser));
                    updateUIForUser(updatedUser);
                    
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            } finally {
                toggleLoader('profile-submit-button', false);
            }
        }

        async function handlePasswordUpdate(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            if (!user) return;

            const formData = {
                username: user.username,
                oldPassword: document.getElementById('current-password').value,
                newPassword: document.getElementById('new-password').value
            };

            if (!formData.oldPassword || !formData.newPassword) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà');
                return;
            }

            toggleLoader('password-submit-button', true);

            try {
                const result = await apiCall('POST', 'updatePassword', formData);
                
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    document.getElementById('password-form').reset();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: ' + error.message);
            } finally {
                toggleLoader('password-submit-button', false);
            }
        }

        function togglePasswordVisibility() {
            const showPassword = document.getElementById('show-password-toggle').checked;
            const currentPassword = document.getElementById('current-password');
            const newPassword = document.getElementById('new-password');
            
            currentPassword.type = showPassword ? 'text' : 'password';
            newPassword.type = showPassword ? 'text' : 'password';
        }

        // --- BASIC FORM FUNCTIONS ---

        async function resetRequestForm() {
            document.getElementById('request-form').reset();
            document.getElementById('form-request-id').value = '';
            document.getElementById('form-attendees-list').innerHTML = '';
            document.getElementById('form-result').classList.add('hidden');
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('form-doc-date').value = today;
            document.getElementById('form-start-date').value = today;
            document.getElementById('form-end-date').value = today;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ department change handler
            document.getElementById('form-department').addEventListener('change', (e) => {
                const selectedDept = e.target.value;
                document.getElementById('form-head-name').value = specialPositionMap[selectedDept] || '';
            });
        }

        function addAttendeeField() {
            const list = document.getElementById('form-attendees-list');
            const attendeeDiv = document.createElement('div');
            attendeeDiv.className = 'grid grid-cols-1 md:grid-cols-3 gap-2 items-center mb-2';
            attendeeDiv.innerHTML = `
                <input type="text" class="form-input attendee-name md:col-span-1" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                <div class="attendee-position-wrapper md:col-span-1">
                     <select class="form-input attendee-position-select">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                        <option value="‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á">‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                        <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
                    </select>
                    <input type="text" class="form-input attendee-position-other hidden mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">‡∏•‡∏ö</button>
            `;
            list.appendChild(attendeeDiv);
            
            const select = attendeeDiv.querySelector('.attendee-position-select');
            const otherInput = attendeeDiv.querySelector('.attendee-position-other');

            select.addEventListener('change', () => {
                otherInput.classList.toggle('hidden', select.value !== 'other');
            });
        }

        function toggleExpenseOptions() {
            const partialOptions = document.getElementById('partial-expense-options');
            const totalContainer = document.getElementById('total-expense-container');
            if (document.getElementById('expense_partial').checked) {
                partialOptions.classList.remove('hidden');
                totalContainer.classList.remove('hidden');
            } else {
                partialOptions.classList.add('hidden');
                totalContainer.classList.add('hidden');
            }
        }
        
        function toggleVehicleDetails() {
            const privateDetails = document.getElementById('private-vehicle-details');
            const publicDetails = document.getElementById('public-vehicle-details');
            const privateCheckbox = document.querySelector('input[name="vehicle_option"][value="private"]');
            const publicCheckbox = document.querySelector('input[name="vehicle_option"][value="public"]');

            privateDetails.classList.toggle('hidden', !privateCheckbox.checked);
            publicDetails.classList.toggle('hidden', !publicCheckbox.checked);
        }

        async function handleRequestFormSubmit(e) {
    e.preventDefault();
    
    const user = getCurrentUser();
    if (!user) {
        showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô');
        return;
    }

    const formData = {
        username: user.username,
        docDate: document.getElementById('form-doc-date').value,
        requesterName: document.getElementById('form-requester-name').value,
        requesterPosition: document.getElementById('form-requester-position').value,
        location: document.getElementById('form-location').value,
        purpose: document.getElementById('form-purpose').value,
        startDate: document.getElementById('form-start-date').value,
        endDate: document.getElementById('form-end-date').value,
        attendees: Array.from(document.querySelectorAll('#form-attendees-list > div')).map(div => {
            const select = div.querySelector('.attendee-position-select');
            let position = select.value;
            if (position === 'other') {
                position = div.querySelector('.attendee-position-other').value;
            }
            return {
                name: div.querySelector('.attendee-name').value,
                position: position
            };
        }).filter(att => att.name && att.position),
        expenseOption: document.querySelector('input[name="expense_option"]:checked').value,
        expenseItems: [],
        totalExpense: document.getElementById('form-total-expense').value || 0,
        vehicleOption: document.querySelector('input[name="vehicle_option"]:checked').value,
        licensePlate: document.getElementById('form-license-plate').value,
        department: document.getElementById('form-department').value,
        headName: document.getElementById('form-head-name').value,
        isEdit: false // ‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
    };

    if (formData.expenseOption === 'partial') {
        document.querySelectorAll('input[name="expense_item"]:checked').forEach(chk => {
            const item = { name: chk.dataset.itemName };
            if (item.name === '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                item.detail = document.getElementById('expense_other_text').value;
            }
            formData.expenseItems.push(item);
        });
    }

    toggleLoader('submit-request-button', true);

    try {
        const result = await apiCall('POST', 'createRequest', formData);
        
        if (result.status === 'success') {
            document.getElementById('form-result-title').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            document.getElementById('form-result-message').textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ó‡∏µ‡πà ${result.data.id} ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß`;
            
            // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ pdfUrl ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            if (result.data.pdfUrl) {
                document.getElementById('form-result-link').href = result.data.pdfUrl;
                document.getElementById('form-result-link').classList.remove('hidden');
            } else {
                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ pdfUrl ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå
                document.getElementById('form-result-link').classList.add('hidden');
                document.getElementById('form-result-message').textContent += ' (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ)';
            }
            
            document.getElementById('form-result').classList.remove('hidden');
            
            document.getElementById('request-form').reset();
            document.getElementById('form-attendees-list').innerHTML = '';
            
            clearRequestsCache();
            await fetchUserRequests();
        } else {
            showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
        }
    } catch (error) {
        showAlert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏î‡πâ: ' + error.message);
    } finally {
        toggleLoader('submit-request-button', false);
    }
}
        // --- BASIC ADMIN FUNCTIONS ---

        function renderUsersList(users) {
            const container = document.getElementById('users-content');
            
            if (!users || users.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</p>';
                return;
            }

            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full bg-white">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                                <th class="px-4 py-2 text-left">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                                <th class="px-4 py-2 text-left">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                                <th class="px-4 py-2 text-left">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞/‡∏á‡∏≤‡∏ô</th>
                                <th class="px-4 py-2 text-left">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                                <th class="px-4 py-2 text-left">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr class="border-b">
                                    <td class="px-4 py-2">${user.username}</td>
                                    <td class="px-4 py-2">${user.fullName}</td>
                                    <td class="px-4 py-2">${user.position}</td>
                                    <td class="px-4 py-2">${user.department}</td>
                                    <td class="px-4 py-2">${user.role}</td>
                                    <td class="px-4 py-2">
                                        <button onclick="deleteUser('${user.username}')" class="btn btn-danger btn-sm">‡∏•‡∏ö</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        async function deleteUser(username) {
            const confirmed = await showConfirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö", `‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ${username}?`);
            if (confirmed) {
                try {
                    await apiCall('POST', 'deleteUser', { username });
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    await fetchAllUsers();
                } catch (error) {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ: ' + error.message);
                }
            }
        }

        function openAddUserModal() {
            document.getElementById('register-modal').style.display = 'flex';
        }

        function downloadUserTemplate() {
            const template = [
                ['Username', 'Password', 'FullName', 'Position', 'Department', 'Role', 'SpecialPosition']
            ];
            const ws = XLSX.utils.aoa_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, 'user_template.xlsx');
        }

        async function handleUserImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data);
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                const result = await apiCall('POST', 'importUsers', { users: jsonData });
                
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', result.message);
                    await fetchAllUsers();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            } finally {
                e.target.value = '';
            }
        }

        // --- MEMO FUNCTIONS ---

        async function handleMemoSubmitFromModal(e) {
            e.preventDefault();
            
            const user = getCurrentUser();
            if (!user) return;

            const requestId = document.getElementById('memo-modal-request-id').value;
            const memoType = document.querySelector('input[name="modal_memo_type"]:checked').value;
            const fileInput = document.getElementById('modal-memo-file');
            
            let fileObject = null;
            if (memoType === 'non_reimburse' && fileInput.files.length > 0) {
                fileObject = await fileToObject(fileInput.files[0]);
            }

            toggleLoader('send-memo-submit-button', true);

            try {
                const result = await apiCall('POST', 'uploadMemo', {
                    refNumber: requestId,
                    file: fileObject,
                    username: user.username,
                    memoType: memoType
                });
                
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    document.getElementById('send-memo-modal').style.display = 'none';
                    document.getElementById('send-memo-form').reset();
                    await fetchUserRequests();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°: ' + error.message);
            } finally {
                toggleLoader('send-memo-submit-button', false);
            }
        }

        // --- STATS FUNCTIONS ---

        async function loadStatsData() {
            try {
                console.log("üîÑ Loading stats data...");
                
                const user = getCurrentUser();
                if (!user) {
                    console.error("‚ùå No user found!");
                    return;
                }

                // ‡πÅ‡∏™‡∏î‡∏á loading state
                const container = document.getElementById('stats-overview');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center p-8">
                            <div class="loader mx-auto"></div>
                            <p class="mt-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...</p>
                        </div>
                    `;
                }

                // ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤
                const chartsSection = document.getElementById('stats-charts');
                if (chartsSection) {
                    chartsSection.classList.add('hidden');
                }

                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const [requestsResult, memosResult, usersResult] = await Promise.all([
                    apiCall('GET', 'getAllRequests').catch(err => {
                        console.error("Error loading requests:", err);
                        return { status: 'success', data: [] };
                    }),
                    apiCall('GET', 'getAllMemos').catch(err => {
                        console.error("Error loading memos:", err);
                        return { status: 'success', data: [] };
                    }),
                    apiCall('GET', 'getAllUsers').catch(err => {
                        console.error("Error loading users:", err);
                        return { status: 'success', data: [] };
                    })
                ]);

                console.log("üì• API Results:", {
                    requests: requestsResult?.data?.length,
                    memos: memosResult?.data?.length, 
                    users: usersResult?.data?.length
                });

                const requests = requestsResult?.data || [];
                const memos = memosResult?.data || [];
                const users = usersResult?.data || [];

                // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà admin)
                const userRequests = user.role === 'admin' ? requests : requests.filter(req => req.username === user.username);
                const userMemos = user.role === 'admin' ? memos : memos.filter(memo => memo.submittedBy === user.username);

                console.log("üìä Filtered data:", {
                    userRequests: userRequests.length,
                    userMemos: userMemos.length,
                    users: users.length
                });

                renderStatsOverview(userRequests, userMemos, users, user);
                
            } catch (error) {
                console.error('‚ùå Error loading stats:', error);
                const container = document.getElementById('stats-overview');
                if (container) {
                    container.innerHTML = `
                        <div class="text-center p-8 text-red-500">
                            <p>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥: ${error.message}</p>
                            <button onclick="loadStatsData()" class="btn btn-primary mt-4">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                        </div>
                    `;
                }
            }
        }

        function renderStatsOverview(requests, memos, users, currentUser) {
            const container = document.getElementById('stats-overview');
            
            // 1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
            const stats = calculateStats(requests, memos, users, currentUser);
            
            // 2. Render ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ 4 ‡πÉ‡∏ö
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°) -->
                    <div class="stat-card bg-white rounded-lg shadow p-4 border-l-4 border-blue-500">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-gray-900">${stats.totalRequests}</p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bg-white rounded-lg shadow p-4 border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                                <p class="text-2xl font-bold text-gray-900">${stats.completedRequests}</p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bg-white rounded-lg shadow p-4 border-l-4 border-purple-500">
                        <div class="flex items-center">
                            <div class="bg-purple-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>
                                <p class="text-2xl font-bold text-gray-900">${stats.totalMemos}</p>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card bg-white rounded-lg shadow p-4 border-l-4 border-yellow-500">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 p-3 rounded-lg">
                                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path></svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-gray-900">${stats.totalUsers}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="stats-charts" class="mt-8">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <h3 class="text-lg font-bold mb-4 text-gray-800">‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
                            <canvas id="requests-chart"></canvas>
                        </div>
                        <div class="chart-container" style="position: relative; height: 300px;">
                            <h3 class="text-lg font-bold mb-4 text-gray-800">‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h3>
                            <canvas id="status-chart"></canvas>
                        </div>
                    </div>
                </div>
            `;

            // 3. ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (window.requestsChartInstance) {
                window.requestsChartInstance.destroy();
                window.requestsChartInstance = null;
            }
            if (window.statusChartInstance) {
                window.statusChartInstance.destroy();
                window.statusChartInstance = null;
            }

            // 4. ‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
            setTimeout(() => {
                createCharts(stats);
            }, 100);
        }

        function createCharts(stats) {
            console.log("üìä Creating charts with data:", stats);
            
            // 5. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á (‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
            const monthlyCtx = document.getElementById('requests-chart');
            if (monthlyCtx) {
                const monthlyLabels = stats.monthlyStats.map(m => m.month);
                const monthlyData = stats.monthlyStats.map(m => m.count);

                console.log("üìà Monthly chart data:", { labels: monthlyLabels, data: monthlyData });

                window.requestsChartInstance = new Chart(monthlyCtx, {
                    type: 'bar',
                    data: {
                        labels: monthlyLabels,
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠',
                            data: monthlyData,
                            backgroundColor: 'rgba(79, 70, 229, 0.6)',
                            borderColor: 'rgba(79, 70, 229, 1)',
                            borderWidth: 1,
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                display: false 
                            },
                            tooltip: {
                                callbacks: {
                                    title: (tooltipItems) => `‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${tooltipItems[0].label}`,
                                    label: (tooltipItem) =>  `${tooltipItem.raw} ‡∏Ñ‡∏≥‡∏Ç‡∏≠`
                                }
                            }
                        },
                        scales: {
                            y: { 
                                beginAtZero: true,
                                ticks: {
                                    precision: 0
                                },
                                grid: { 
                                    color: 'rgba(229, 231, 235, 0.5)' 
                                }
                            },
                            x: { 
                                grid: { 
                                    display: false 
                                }
                            }
                        }
                    }
                });
                
                console.log("‚úÖ Monthly chart created successfully");
            } else {
                console.error("‚ùå Could not find requests-chart canvas");
            }

            // 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡πÅ‡∏´‡∏ß‡∏ô (‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)
            const statusCtx = document.getElementById('status-chart');
            if (statusCtx) {
                const statusEntries = Object.entries(stats.requestStatus);
                const statusLabels = statusEntries.map(([status, count]) => `${translateStatus(status)} (${count})`);
                const statusData = statusEntries.map(([status, count]) => count);
                
                const statusColors = [
                    'rgba(22, 163, 74, 0.7)',  // green-600
                    'rgba(59, 130, 246, 0.7)', // blue-500
                    'rgba(245, 158, 11, 0.7)', // yellow-500
                    'rgba(239, 68, 68, 0.7)',  // red-500
                    'rgba(168, 85, 247, 0.7)', // purple-500
                    'rgba(249, 115, 22, 0.7)'  // orange-500
                ];

                console.log("üìä Status chart data:", { labels: statusLabels, data: statusData });

                window.statusChartInstance = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: statusLabels,
                        datasets: [{
                            data: statusData,
                            backgroundColor: statusColors.slice(0, statusData.length),
                            borderColor: 'rgba(255, 255, 255, 0.8)',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom', 
                                labels: { 
                                    padding: 15,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                } 
                            },
                            tooltip: {
                                callbacks: {
                                    label: (tooltipItem) => {
                                        const label = tooltipItem.label || '';
                                        const value = tooltipItem.raw || 0;
                                        return `${label.split(' (')[0]}: ${value} ‡∏Ñ‡∏≥‡∏Ç‡∏≠`;
                                    }
                                }
                            }
                        },
                        cutout: '50%'
                    }
                });
                
                console.log("‚úÖ Status chart created successfully");
            } else {
                console.error("‚ùå Could not find status-chart canvas");
            }

            // 7. ‡πÅ‡∏™‡∏î‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏£‡∏≤‡∏ü
            const chartsSection = document.getElementById('stats-charts');
            if (chartsSection) {
                chartsSection.classList.remove('hidden');
                console.log("‚úÖ Charts section displayed");
            }
        }

        function calculateStats(requests, memos, users, currentUser) {
            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
            const totalRequests = requests.length;
            const totalMemos = memos.length;
            const totalUsers = users.length;

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠
            const requestStatus = {};
            requests.forEach(req => {
                const status = req.status || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                requestStatus[status] = (requestStatus[status] || 0) + 1;
            });

            // ‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
            const completedRequests = requests.filter(req => 
                req.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' || 
                req.status === 'Approved' ||
                req.commandStatus === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£'
            ).length;

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
            const departmentStats = {};
            requests.forEach(req => {
                const dept = req.department || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏ú‡∏ô‡∏Å';
                departmentStats[dept] = (departmentStats[dept] || 0) + 1;
            });

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin)
            const userStats = {
                total: users.length,
                admins: users.filter(u => u.role === 'admin').length,
                regularUsers: users.filter(u => u.role === 'user').length
            };

            // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
            const monthlyStats = calculateMonthlyStats(requests);

            return {
                totalRequests,
                completedRequests,
                totalMemos,
                totalUsers,
                requestStatus,
                departmentStats,
                userStats,
                monthlyStats
            };
        }

        function calculateMonthlyStats(requests) {
            const months = [];
            const now = new Date();
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthKey = date.toLocaleDateString('th-TH', { year: 'numeric', month: 'long' });
                
                const monthStart = new Date(date.getFullYear(), date.getMonth(), 1);
                const monthEnd = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                
                const monthRequests = requests.filter(req => {
                    const dateString = req.timestamp || req.startDate || req.docDate || req.createdAt;
                    if (!dateString) return false;
                    
                    try {
                        const reqDate = new Date(dateString);
                        if (isNaN(reqDate.getTime())) return false;
                        
                        return reqDate >= monthStart && reqDate <= monthEnd;
                    } catch (e) {
                        return false;
                    }
                });
                
                const completedRequests = monthRequests.filter(req => 
                    req.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' || 
                    req.status === 'Approved' ||
                    req.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'
                ).length;
                
                months.push({
                    month: monthKey,
                    count: monthRequests.length,
                    completed: completedRequests
                });
            }
            
            return months;
        }

        // --- TEMPLATE FUNCTIONS ---

        function downloadAttendeeTemplate() {
            const template = [
                ['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•', '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á'],
                ['‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', '‡∏Ñ‡∏£‡∏π'],
                ['‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ2', '‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô']
            ];
            const ws = XLSX.utils.aoa_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            XLSX.writeFile(wb, 'attendee_template.xlsx');
        }

        async function handleExcelImport(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const data = await file.arrayBuffer();
                const workbook = XLSX.read(data);
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                const attendeesList = document.getElementById('form-attendees-list');
                attendeesList.innerHTML = '';

                jsonData.forEach(row => {
                    if (row['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'] && row['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á']) {
                        addAttendeeFieldWithData(row['‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•'], row['‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á']);
                    }
                });

                showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            } finally {
                e.target.value = '';
            }
        }

        function addAttendeeFieldWithData(name, position) {
            const list = document.getElementById('form-attendees-list');
            const attendeeDiv = document.createElement('div');
            attendeeDiv.className = 'grid grid-cols-1 md:grid-cols-3 gap-2 items-center mb-2';
            
            attendeeDiv.innerHTML = `
                <input type="text" class="form-input attendee-name md:col-span-1" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" value="${name}" required>
                <div class="attendee-position-wrapper md:col-span-1">
                    <select class="form-input attendee-position-select">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á --</option>
                        <option value="‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏£‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢">‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                        <option value="‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á">‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏à‡πâ‡∏≤‡∏á</option>
                        <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                        <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                        <option value="other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
                    </select>
                    <input type="text" class="form-input attendee-position-other hidden mt-1" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" value="${position}">
                </div>
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">‡∏•‡∏ö</button>
            `;
            list.appendChild(attendeeDiv);
            
            const select = attendeeDiv.querySelector('.attendee-position-select');
            const otherInput = attendeeDiv.querySelector('.attendee-position-other');

            const optionExists = Array.from(select.options).some(opt => opt.value === position);
            if (optionExists) {
                select.value = position;
            } else {
                select.value = 'other';
                otherInput.classList.remove('hidden');
            }

            select.addEventListener('change', () => {
                otherInput.classList.toggle('hidden', select.value !== 'other');
            });
        }

        // --- ADMIN COMMAND FUNCTIONS ---

        function renderAdminRequestsList(requests) {
            const container = document.getElementById('admin-requests-list');
            
            if (!requests || requests.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</p>';
                return;
            }

            container.innerHTML = requests.map(request => {
                const hasCommandSolo = request.commandPdfUrlSolo && request.commandPdfUrlSolo.trim() !== '';
                const hasCommandSmall = request.commandPdfUrlGroupSmall && request.commandPdfUrlGroupSmall.trim() !== '';
                const hasCommandLarge = request.commandPdfUrlGroupLarge && request.commandPdfUrlGroupLarge.trim() !== '';
                const hasAnyCommand = hasCommandSolo || hasCommandSmall || hasCommandLarge;

                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏£‡∏ß‡∏° (‡∏£‡∏ß‡∏°‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ + ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á)
                const attendeeCount = request.attendeeCount || 0;
                const totalPeople = attendeeCount + 1; // +1 ‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏á
                let peopleCategory = "";
                if (totalPeople === 1) {
                    peopleCategory = "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß (1 ‡∏Ñ‡∏ô)";
                } else if (totalPeople >= 2 && totalPeople <= 5) {
                    peopleCategory = "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å (2-5 ‡∏Ñ‡∏ô)";
                } else if (totalPeople >= 6) {
                    peopleCategory = "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà (6 ‡∏Ñ‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)";
                }

                return `
                    <div class="border rounded-lg p-4 bg-white">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-indigo-700">${request.id}</h4>
                                <p class="text-sm text-gray-600">‡πÇ‡∏î‡∏¢: ${request.requesterName} | ${request.purpose}</p>
                                <p class="text-sm text-gray-500">${request.location} | ${formatDisplayDate(request.startDate)} - ${formatDisplayDate(request.endDate)}</p>
                                
                                <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô -->
                                <p class="text-sm text-gray-700">‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á: ${attendeeCount} ‡∏Ñ‡∏ô</p>
                                <p class="text-sm font-medium text-blue-700">üë• ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPeople} ‡∏Ñ‡∏ô (${peopleCategory})</p>

                                <p class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠: <span class="font-medium">${translateStatus(request.status)}</span></p>
                                <p class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: <span class="font-medium">${request.commandStatus || '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£'}</span></p>
                            </div>
                            <div class="flex flex-col gap-2">
                                ${request.pdfUrl ? `<a href="${request.pdfUrl}" target="_blank" class="btn btn-success btn-sm">‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠</a>` : ''}
                            
                                <div class="flex gap-1">
                                    ${request.commandPdfUrl ?
    `<a href="${request.commandPdfUrl}" target="_blank" class="btn bg-blue-500 text-white btn-sm">‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</a>` :
    `<button onclick="openAdminGenerateCommand('${request.id}')" class="btn bg-green-500 text-white btn-sm">‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</button>`
}
                                    ${!request.dispatchBookPdfUrl ? `<button onclick="openDispatchModal('${request.id}')" class="btn bg-orange-500 text-white btn-sm">‡∏≠‡∏≠‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</button>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAdminMemosList(memos) {
            const container = document.getElementById('admin-memos-list');
            
            if (!memos || memos.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>';
                return;
            }

            container.innerHTML = memos.map(memo => {
                const hasCompletedFiles = memo.completedMemoUrl || memo.completedCommandUrl || memo.dispatchBookUrl;
                
                return `
                    <div class="border rounded-lg p-4 bg-white">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold">${memo.id}</h4>
                                <p class="text-sm text-gray-600">‡πÇ‡∏î‡∏¢: ${memo.submittedBy} | ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${memo.refNumber}</p>
                                <p class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span class="font-medium">${translateStatus(memo.status)}</span></p>
                                <div class="mt-2 text-xs text-gray-500">
                                    ${memo.completedMemoUrl ? `<div>‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</div>` : ''}
                                    ${memo.completedCommandUrl ? `<div>‚úì ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</div>` : ''}
                                    ${memo.dispatchBookUrl ? `<div>‚úì ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</div>` : ''}
                                </div>
                            </div>
                            <div class="flex flex-col gap-2">
                                ${memo.fileURL ? `<a href="${memo.fileURL}" target="_blank" class="btn btn-success btn-sm">‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á</a>` : ''}
                                ${memo.completedMemoUrl ? `<a href="${memo.completedMemoUrl}" target="_blank" class="btn bg-blue-500 text-white btn-sm">‡∏î‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</a>` : ''}
                                ${memo.completedCommandUrl ? `<a href="${memo.completedCommandUrl}" target="_blank" class="btn bg-blue-500 text-white btn-sm">‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</a>` : ''}
                                ${memo.dispatchBookUrl ? `<a href="${memo.dispatchBookUrl}" target="_blank" class="btn bg-purple-500 text-white btn-sm">‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á</a>` : ''}
                                
                                <button onclick="openAdminMemoAction('${memo.id}')" class="btn bg-green-500 text-white btn-sm">
                                    ${hasCompletedFiles ? '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå' : '‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
        function openCommandApproval(requestId) {
            if (!checkAdminAccess()) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            document.getElementById('command-request-id').value = requestId;
            document.getElementById('command-approval-modal').style.display = 'flex';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏™‡πà‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á
        function openDispatchModal(requestId) {
            if (!checkAdminAccess()) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            document.getElementById('dispatch-request-id').value = requestId;
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const currentYear = new Date().getFullYear() + 543;
            document.getElementById('dispatch-year').value = currentYear;
            document.getElementById('dispatch-modal').style.display = 'flex';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        function openAdminMemoAction(memoId) {
            if (!checkAdminAccess()) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ');
                return;
            }
            document.getElementById('admin-memo-id').value = memoId;
            document.getElementById('admin-memo-action-modal').style.display = 'flex';
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
        async function handleCommandApproval(e) {
            e.preventDefault();
            
            const requestId = document.getElementById('command-request-id').value;
            const commandType = document.querySelector('input[name="command_type"]:checked')?.value;
            
            if (!commandType) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á');
                return;
            }

            toggleLoader('command-approval-submit-button', true);

            try {
                const result = await apiCall('POST', 'approveCommand', {
                    requestId: requestId,
                    templateType: commandType
                });
                
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    document.getElementById('command-approval-modal').style.display = 'none';
                    document.getElementById('command-approval-form').reset();
                    await fetchAllRequestsForCommand();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á: ' + error.message);
            } finally {
                toggleLoader('command-approval-submit-button', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á
        async function handleDispatchFormSubmit(e) {
            e.preventDefault();
            
            const requestId = document.getElementById('dispatch-request-id').value;
            const dispatchMonth = document.getElementById('dispatch-month').value;
            const dispatchYear = document.getElementById('dispatch-year').value;
            const commandCount = document.getElementById('command-count').value;
            const memoCount = document.getElementById('memo-count').value;

            if (!dispatchMonth || !dispatchYear || !commandCount || !memoCount) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            toggleLoader('dispatch-submit-button', true);

            try {
                const result = await apiCall('POST', 'generateDispatchBook', {
                    requestId: requestId,
                    dispatchMonth: dispatchMonth,
                    dispatchYear: dispatchYear,
                    commandCount: commandCount,
                    memoCount: memoCount
                });
                
                if (result.status === 'success') {
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                    document.getElementById('dispatch-modal').style.display = 'none';
                    document.getElementById('dispatch-form').reset();
                    await fetchAllRequestsForCommand();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á: ' + error.message);
            } finally {
                toggleLoader('dispatch-submit-button', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô async function
        async function handleAdminMemoActionSubmit(e) {
            e.preventDefault();
            
            const memoId = document.getElementById('admin-memo-id').value;
            const status = document.getElementById('admin-memo-status').value;
            
            const completedMemoFile = document.getElementById('admin-completed-memo-file').files[0];
            const completedCommandFile = document.getElementById('admin-completed-command-file').files[0];
            const dispatchBookFile = document.getElementById('admin-dispatch-book-file').files[0];

            let completedMemoFileObject = null;
            let completedCommandFileObject = null;
            let dispatchBookFileObject = null;

            // ‡πÅ‡∏õ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô object
            if (completedMemoFile) {
                completedMemoFileObject = await fileToObject(completedMemoFile);
            }
            if (completedCommandFile) {
                completedCommandFileObject = await fileToObject(completedCommandFile);
            }
            if (dispatchBookFile) {
                dispatchBookFileObject = await fileToObject(dispatchBookFile);
            }

            toggleLoader('admin-memo-submit-button', true);

            try {
                const result = await apiCall('POST', 'updateMemoStatus', {
                    id: memoId,
                    status: status,
                    completedMemoFile: completedMemoFileObject,
                    completedCommandFile: completedCommandFileObject,
                    dispatchBookFile: dispatchBookFileObject
                });
                
                if (result.status === 'success') {
                    // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                    if (status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô') {
                        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å memo
                        const memo = allMemosCache.find(m => m.id === memoId);
                        if (memo && memo.submittedBy) {
                            await sendCompletionEmail(memo.refNumber, memo.submittedBy, status);
                        }
                    }
                    
                    showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
                    document.getElementById('admin-memo-action-modal').style.display = 'none';
                    document.getElementById('admin-memo-action-form').reset();
                    await fetchAllMemos();
                } else {
                    showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }
            } catch (error) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ' + error.message);
            } finally {
                toggleLoader('admin-memo-submit-button', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
        async function sendCompletionEmail(requestId, username, status) {
            try {
                console.log(`üìß ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: requestId=${requestId}, username=${username}, status=${status}`);
                
                const result = await apiCall('POST', 'sendCompletionEmail', {
                    requestId: requestId,
                    username: username,
                    status: status
                });
                
                if (result.status === 'success') {
                    console.log('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                } else {
                    console.warn('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ:', result.message);
                }
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•:', error);
                // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á alert ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏î‡∏¢‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        async function handleAdminGenerateCommand() {
            const requestId = document.getElementById('admin-command-request-id').value;
            const commandType = document.querySelector('input[name="admin-command-type"]:checked')?.value;
            
            if (!commandType) {
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á');
                return;
            }

            toggleLoader('admin-generate-command-button', true);

            try {
                const result = await apiCall('POST', 'approveCommand', {
                    requestId: requestId,
                    templateType: commandType
                });
                
                if (result.status === 'success') {
                    document.getElementById('admin-command-result-title').textContent = '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                    document.getElementById('admin-command-result-message').textContent = `‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ID ${requestId} ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß`;
                    
                    if (result.data.pdfUrl) {
        document.getElementById('admin-command-result-link').href = result.data.pdfUrl;
        document.getElementById('admin-command-result-link').classList.remove('hidden');
    } else {
        document.getElementById('admin-command-result-link').classList.add('hidden');
        document.getElementById('admin-command-result-message').textContent += ' (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ)';
    }
    
    document.getElementById('admin-command-form').classList.add('hidden');
    
    showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    
} else {
    showAlert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", result.message || "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ");
}
            } catch (error) {
                console.error("Error generating admin command:", error);
                showAlert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ: " + error.message);
            } finally {
                toggleLoader('admin-generate-command-button', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        async function exportStatsReport() {
            try {
                const user = getCurrentUser();
                if (!user) return;

                toggleLoader('export-stats', true);

                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const [requestsResult, memosResult, usersResult] = await Promise.all([
                    apiCall('GET', 'getAllRequests'),
                    apiCall('GET', 'getAllMemos'),
                    apiCall('GET', 'getAllUsers')
                ]);

                const requests = requestsResult.data || [];
                const memos = memosResult.data || [];
                const users = usersResult.data || [];

                // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                const userRequests = user.role === 'admin' ? requests : requests.filter(req => req.username === user.username);
                const stats = calculateStats(userRequests, memos, users, user);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Excel report
                const reportData = [
                    ['‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£', '', '', ''],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', new Date().toLocaleDateString('th-TH'), '', ''],
                    ['', '', '', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', '', '', ''],
                    ['‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', stats.totalRequests, '', ''],
                    ['‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', stats.completedRequests, '', ''],
                    ['‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°', stats.totalMemos, '', ''],
                    ['‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', stats.totalUsers, '', ''],
                    ['', '', '', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '', '', ''],
                    ...Object.entries(stats.requestStatus).map(([status, count]) => [translateStatus(status), count, '', '']),
                    ['', '', '', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å', '', '', ''],
                    ...Object.entries(stats.departmentStats).map(([dept, count]) => [dept, count, '', '']),
                    ['', '', '', ''],
                    ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '', '', ''],
                    ['‡πÄ‡∏î‡∏∑‡∏≠‡∏ô', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠', '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', ''],
                    ...stats.monthlyStats.map(month => [month.month, month.count, month.completed, ''])
                ];

                if (user.role === 'admin') {
                    reportData.splice(9, 0, 
                        ['', '', '', ''],
                        ['‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ', '', '', ''],
                        ['‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', stats.userStats.total, '', ''],
                        ['‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', stats.userStats.admins, '', ''],
                        ['‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', stats.userStats.regularUsers, '', '']
                    );
                }

                const ws = XLSX.utils.aoa_to_sheet(reportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£');
                
                const fileName = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);

                showAlert('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');

            } catch (error) {
                console.error('Error exporting stats:', error);
                showAlert('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
            } finally {
                toggleLoader('export-stats', false);
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ
        function setupVehicleOptions() {
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            document.querySelectorAll('input[name="vehicle_option"].vehicle-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', toggleVehicleDetails);
            });
            
            // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            document.querySelectorAll('input[name="edit-vehicle_option"].vehicle-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', toggleEditVehicleDetails);
            });
        }

        function toggleEditVehicleDetails() {
    const privateDetails = document.getElementById('edit-private-vehicle-details'); // ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const publicDetails = document.getElementById('edit-public-vehicle-details'); // ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
    const privateCheckbox = document.querySelector('input[name="edit-vehicle_option"][value="private"]');
    const publicCheckbox = document.querySelector('input[name="edit-vehicle_option"][value="public"]');

    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ element ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà null ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    if (privateDetails) {
        privateDetails.classList.toggle('hidden', !privateCheckbox.checked);
    }
    if (publicDetails) {
        publicDetails.classList.toggle('hidden', !publicCheckbox.checked);
    }
}

        // üß† ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ (‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏±‡πâ‡∏á window.currentUser ‡πÅ‡∏•‡∏∞ sessionStorage)
        function tryAutoFillRequester(retry = 0) {
            const nameInput = document.getElementById('form-requester-name');
            const posInput = document.getElementById('form-requester-position');
            const dateInput = document.getElementById('form-doc-date');

            if (!nameInput || !posInput) {
                console.warn("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏ö element ‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠/‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô DOM");
                if (retry < 5) setTimeout(() => tryAutoFillRequester(retry + 1), 500);
                return;
            }

            // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á
            if (dateInput && !dateInput.value) {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                dateInput.value = `${yyyy}-${mm}-${dd}`;
            }

            // ‚úÖ ‡∏î‡∏∂‡∏á currentUser ‡∏à‡∏≤‡∏Å window ‡∏´‡∏£‡∏∑‡∏≠ sessionStorage
            let user = window.currentUser;
            if (!user) {
                const storedUser = sessionStorage.getItem('currentUser');
                if (storedUser) {
                    try {
                        user = JSON.parse(storedUser);
                        window.currentUser = user;
                        console.log("‚ôªÔ∏è ‡πÇ‡∏´‡∏•‡∏î currentUser ‡∏à‡∏≤‡∏Å sessionStorage:", user);
                    } catch (err) {
                        console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• currentUser:", err);
                    }
                }
            }

            // ‚úÖ ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (user) {
                nameInput.value = user.fullName || user.username || '';
                posInput.value = user.position || '';
                console.log("‚úÖ ‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‚Äì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", user.fullName, user.position);
            } else {
                console.warn("‚è≥ currentUser ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° (‡∏£‡∏≠‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô 1 ‡∏ß‡∏¥) ‚Äì ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà", retry + 1);
                if (retry < 5) setTimeout(() => tryAutoFillRequester(retry + 1), 1000);
            }
        }

        // üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function checkEditPageStatus() {
            console.log("üîç Edit Page Status Check:");
            console.log("- currentEditRequestId:", sessionStorage.getItem('currentEditRequestId'));
            console.log("- openEditPage function:", typeof openEditPage);
            console.log("- populateEditForm function:", typeof populateEditForm);
            console.log("- edit page element:", document.getElementById('edit-page'));
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏à‡∏≤‡∏Å console browser ‡πÑ‡∏î‡πâ
        window.checkEditPageStatus = checkEditPageStatus;
// --- PUBLIC WEEKLY SCHEDULE FUNCTIONS ---

       async function loadPublicWeeklyData() {
            try {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                const now = new Date();
                const startOfWeek = new Date(now);
                startOfWeek.setDate(now.getDate() - now.getDay() + 1); // ‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå
                const endOfWeek = new Date(now);
                endOfWeek.setDate(now.getDate() - now.getDay() + 7); // ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
                
                const dateOptions = { day: 'numeric', month: 'short', year: '2-digit' };
                document.getElementById('current-week-display').textContent = 
                    `${startOfWeek.toLocaleDateString('th-TH', dateOptions)} - ${endOfWeek.toLocaleDateString('th-TH', dateOptions)}`;

                // [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Requests ‡πÅ‡∏•‡∏∞ Memos ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                const [requestsResult, memosResult] = await Promise.all([
                    apiCall('GET', 'getAllRequests'),
                    apiCall('GET', 'getAllMemos')
                ]);
                
                if (requestsResult.status === 'success') {
                    const requests = requestsResult.data;
                    const memos = memosResult.status === 'success' ? memosResult.data : [];

                    // [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏ú‡∏™‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏ô‡∏≥‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å Memo ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô Request
                    const enrichedRequests = requests.map(req => {
                        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ Memo ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Request ID ‡∏ô‡∏µ‡πâ
                        const relatedMemo = memos.find(m => m.refNumber === req.id);
                        return {
                            ...req,
                            // ‡∏î‡∏∂‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                            completedCommandUrl: relatedMemo ? relatedMemo.completedCommandUrl : null,
                            // ‡∏î‡∏∂‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å Memo ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Å‡∏ß‡πà‡∏≤)
                            realStatus: relatedMemo ? relatedMemo.status : req.status
                        };
                    });

                    renderPublicTable(enrichedRequests);
                } else {
                    document.getElementById('public-weekly-list').innerHTML = 
                        `<tr><td colspan="4" class="text-center py-4 text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>`;
                }
            } catch (error) {
                console.error("Error loading public data:", error);
                document.getElementById('public-weekly-list').innerHTML = 
                    `<tr><td colspan="4" class="text-center py-4 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</td></tr>`;
            }
        }

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏¥‡∏î Modal
        let currentPublicWeeklyData = [];

       function renderPublicTable(requests) {
            const tbody = document.getElementById('public-weekly-list');
            const now = new Date();
            
            // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Ç‡∏≠‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
            const currentDay = now.getDay(); 
            const diffToMonday = now.getDate() - currentDay + (currentDay === 0 ? -6 : 1);
            const monday = new Date(now.setDate(diffToMonday));
            monday.setHours(0,0,0,0);
            
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            sunday.setHours(23,59,59,999);

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ
            const weeklyRequests = requests.filter(req => {
                if (!req.startDate || !req.endDate) return false;
                const start = new Date(req.startDate);
                const end = new Date(req.endDate);
                return (start <= sunday && end >= monday);
            }).sort((a, b) => new Date(a.startDate) - new Date(b.startDate));

            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (weeklyRequests.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center py-10 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</td></tr>`;
                return;
            }

            tbody.innerHTML = weeklyRequests.map((req) => {
                // 1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°
                let attendeesList = [];
                if (typeof req.attendees === 'string') {
                    try { attendeesList = JSON.parse(req.attendees); } catch (e) { attendeesList = []; }
                } else if (Array.isArray(req.attendees)) {
                    attendeesList = req.attendees;
                }

                let attendeesText = "";
                if (attendeesList.length > 0) {
                    attendeesText = `<div class="text-xs text-gray-500 mt-1">üë• ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ì‡∏∞‡∏£‡∏ß‡∏° ${attendeesList.length + 1} ‡∏Ñ‡∏ô</div>`;
                }

                // 2. ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                const startD = new Date(req.startDate);
                const endD = new Date(req.endDate);
                let dateText = formatDisplayDate(req.startDate);
                if (startD.getTime() !== endD.getTime()) {
                    dateText += ` - ${formatDisplayDate(req.endDate)}`;
                }

                // 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                const finalCommandUrl = req.completedCommandUrl; 
                
                let actionHtml = '';
                
                if (finalCommandUrl && finalCommandUrl.trim() !== "") {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                    actionHtml = `
                        <a href="${finalCommandUrl}" target="_blank" class="btn bg-green-600 hover:bg-green-700 text-white btn-sm shadow-md transition-transform hover:scale-105 inline-flex items-center gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            ‡∏î‡∏π‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)
                        </a>
                    `;
                } else {
                    // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå
                    let displayStatus = req.realStatus || req.status;
                    let badgeClass = 'bg-gray-100 text-gray-600';
                    let icon = '';
                    
                    if (displayStatus === 'Pending' || displayStatus === '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£') {
                        badgeClass = 'bg-yellow-100 text-yellow-700 border border-yellow-200';
                        icon = '‚è≥';
                    } else if (displayStatus && displayStatus.includes('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç')) {
                        badgeClass = 'bg-red-100 text-red-700 border border-red-200';
                        icon = '‚ö†Ô∏è';
                    } else if (displayStatus === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') {
                        badgeClass = 'bg-blue-50 text-blue-600 border border-blue-100';
                        icon = 'üìù';
                        displayStatus = '‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á';
                    } else {
                        badgeClass = 'bg-gray-100 text-gray-600 border border-gray-200';
                        icon = 'üîÑ';
                    }

                    actionHtml = `
                        <span class="${badgeClass} px-3 py-1 rounded-full text-xs font-medium">
                            ${icon} ${translateStatus(displayStatus)}
                        </span>
                    `;
                }

                return `
                    <tr class="border-b hover:bg-gray-50 transition">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-indigo-600">
                            ${dateText}
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-bold text-gray-800">${req.requesterName}</div>
                            <div class="text-xs text-gray-500">${req.requesterPosition || ''}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="font-medium text-gray-900 truncate max-w-xs" title="${req.purpose}">${req.purpose}</div>
                            <div class="text-xs text-gray-500">‡∏ì ${req.location}</div>
                            ${attendeesText}
                        </td>
                        <td class="px-6 py-4 text-center align-middle">
                            ${actionHtml}
                        </td>
                    </tr>
                `;
            }).join('');
        }
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
        function openPublicAttendeeModal(index) {
            const req = currentPublicWeeklyData[index];
            if (!req) return;

            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
            document.getElementById('public-modal-purpose').textContent = req.purpose;
            document.getElementById('public-modal-location').textContent = req.location;
            
            const startD = new Date(req.startDate);
            const endD = new Date(req.endDate);
            let dateText = formatDisplayDate(req.startDate);
            if (startD.getTime() !== endD.getTime()) {
                dateText += ` ‡∏ñ‡∏∂‡∏á ${formatDisplayDate(req.endDate)}`;
            }
            document.getElementById('public-modal-date').textContent = dateText;

            // ‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            const listBody = document.getElementById('public-modal-attendee-list');
            let html = '';
            let count = 1;

            // 1. ‡∏ú‡∏π‡πâ‡∏Ç‡∏≠ (‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á)
            html += `
                <tr class="bg-blue-50/50">
                    <td class="px-4 py-2 font-bold text-center">${count++}</td>
                    <td class="px-4 py-2 font-bold text-blue-800">${req.requesterName} (‡∏ú‡∏π‡πâ‡∏Ç‡∏≠)</td>
                    <td class="px-4 py-2 text-gray-600">${req.requesterPosition}</td>
                </tr>
            `;

            // 2. ‡∏ú‡∏π‡πâ‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á
            if (req.attendees && req.attendees.length > 0) {
                req.attendees.forEach(att => {
                    html += `
                        <tr class="border-t">
                            <td class="px-4 py-2 text-center text-gray-500">${count++}</td>
                            <td class="px-4 py-2 text-gray-800">${att.name}</td>
                            <td class="px-4 py-2 text-gray-600">${att.position}</td>
                        </tr>
                    `;
                });
            }

            listBody.innerHTML = html;

            // ‡πÄ‡∏õ‡∏¥‡∏î Modal
            document.getElementById('public-attendee-modal').style.display = 'flex';
        }
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log('App Initializing with Google Sheets Backend...');
            loadPublicWeeklyData();
            setupEventListeners();
            enhanceEditFunctionSafety();
            

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ Chart.js ‡πÉ‡∏ä‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Sarabun ‡πÅ‡∏•‡∏∞‡∏™‡πÑ‡∏ï‡∏•‡πå Tooltip
            Chart.defaults.font.family = "'Sarabun', sans-serif";
            Chart.defaults.font.size = 14;
            Chart.defaults.color = '#374151'; // gray-700
            Chart.defaults.borderColor = 'rgba(229, 231, 235, 0.5)'; // gray-200
            Chart.defaults.plugins.tooltip.enabled = true;
            Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(17, 24, 39, 0.9)'; // gray-900
            Chart.defaults.plugins.tooltip.titleFont = { size: 16, weight: 'bold' };
            Chart.defaults.plugins.tooltip.bodyFont = { size: 14 };
            Chart.defaults.plugins.tooltip.padding = 10;
            Chart.defaults.plugins.tooltip.cornerRadius = 6;
            Chart.defaults.plugins.tooltip.displayColors = true;
            Chart.defaults.plugins.tooltip.boxPadding = 4;
    
            // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÅ‡∏ó‡πá‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            const navEdit = document.getElementById('nav-edit');
            if (navEdit) {
                navEdit.classList.add('hidden');
            }
            
            // ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            resetEditPage();
            
            const user = getCurrentUser();
            if (user) {
                initializeUserSession(user);
            } else {
                showLoginScreen();
            }
        });
// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
async function saveDraft() {
    console.log("üíæ Saving draft...");
    
    try {
        const formData = getEditFormData();
        if (!formData) {
            return false;
        }

        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ flag ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô draft
        formData.isDraft = true;
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á
        const result = await apiCall('POST', 'saveDraft', formData);
        
        if (result.status === 'success') {
            showAlert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
            return true;
        } else {
            console.warn("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡∏£‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ:", result.message);
            return false;
        }
    } catch (error) {
        console.error("Error saving draft:", error);
        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°
        return false;
    }
}
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
        function enhanceEditFunctionSafety() {
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
            const requiredFunctions = [
                'openEditPage', 
                'generateDocumentFromDraft', 
                'getEditFormData'
            ];
            
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    console.error(`Required function ${funcName} is missing`);
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fallback ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error
                    window[funcName] = function() {
                        showAlert("‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤");
                    };
                }
            });
            
            console.log('Edit function safety check completed');
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ render requests list
        function renderRequestsList(requests, memos, searchTerm = '') {
            const container = document.getElementById('requests-list');
            const noRequestsMessage = document.getElementById('no-requests-message');
            
            if (!requests || requests.length === 0) {
                container.classList.add('hidden');
                noRequestsMessage.classList.remove('hidden');
                return;
            }

            let filteredRequests = requests;
            if (searchTerm) {
                filteredRequests = requests.filter(req => 
                    (req.purpose && req.purpose.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (req.location && req.location.toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (req.id && req.id.toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }

            if (filteredRequests.length === 0) {
                container.classList.add('hidden');
                noRequestsMessage.classList.remove('hidden');
                noRequestsMessage.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤';
                return;
            }

            container.innerHTML = filteredRequests.map(request => {
                // ‡∏´‡∏≤‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
                const relatedMemo = memos.find(memo => memo.refNumber === request.id);
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á - ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
                let displayRequestStatus = request.status;
                let displayCommandStatus = request.commandStatus;
                
                if (relatedMemo) {
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÉ‡∏´‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    displayRequestStatus = relatedMemo.status;
                    displayCommandStatus = relatedMemo.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' ? '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' : relatedMemo.status;
                }
                
                const hasCompletedFiles = relatedMemo && (
                    relatedMemo.completedMemoUrl || 
                    relatedMemo.completedCommandUrl || 
                    relatedMemo.dispatchBookUrl
                );
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                const isFullyCompleted = relatedMemo && relatedMemo.status === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                
                return `
                    <div class="border rounded-lg p-4 mb-4 bg-white shadow-sm ${isFullyCompleted ? 'border-green-300 bg-green-50' : ''}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="font-bold text-lg">${request.id || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™'}</h3>
                                    ${isFullyCompleted ? `
                                        <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                                            ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                        </span>
                                    ` : ''}
                                    ${relatedMemo && relatedMemo.status === '‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' ? `
                                        <span class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded-full">
                                            ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                        </span>
                                    ` : ''}
                                </div>
                                <p class="text-gray-600">${request.purpose || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå'}</p>
                                <p class="text-sm text-gray-500">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà: ${request.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${formatDisplayDate(request.startDate)} - ${formatDisplayDate(request.endDate)}</p>
                                
                                <div class="mt-2 space-y-1">
                                    <p class="text-sm">
                                        <span class="font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠:</span> 
                                        <span class="${getStatusColor(displayRequestStatus)}">${translateStatus(displayRequestStatus)}</span>
                                        ${relatedMemo ? `<span class="text-xs text-gray-500 ml-1">` : ''}
                                    </p>
                                    <p class="text-sm">
                                        <span class="font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á:</span> 
                                        <span class="${getStatusColor(displayCommandStatus || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')}">${translateStatus(displayCommandStatus || '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£')}</span>
                                        ${relatedMemo ? `<span class="text-xs text-gray-500 ml-1">` : ''}
                                    </p>
                                    
                                    ${relatedMemo ? `
                                        <p class="text-sm">
                                            <span class="font-medium">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</span> 
                                            <span class="${getStatusColor(relatedMemo.status)}">${translateStatus(relatedMemo.status)}</span>
                                            <span class="text-xs text-blue-500 ml-1">
                                        </p>
                                    ` : ''}
                                </div>
                                
                                ${hasCompletedFiles ? `
                                    <div class="mt-3 p-3 bg-green-50 rounded-lg border border-green-200">
                                        <p class="text-sm font-medium text-green-800 mb-2">üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î:</p>
                                        <div class="flex flex-wrap gap-2">
                                            ${relatedMemo.completedMemoUrl ? `
                                                <a href="${relatedMemo.completedMemoUrl}" target="_blank" class="btn btn-success btn-sm text-xs">
                                                    üìÑ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                                                </a>
                                            ` : ''}
                                            ${relatedMemo.completedCommandUrl ? `
                                                <a href="${relatedMemo.completedCommandUrl}" target="_blank" class="btn bg-blue-500 text-white btn-sm text-xs">
                                                    üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                                                </a>
                                            ` : ''}
                                            ${relatedMemo.dispatchBookUrl ? `
                                                <a href="${relatedMemo.dispatchBookUrl}" target="_blank" class="btn bg-purple-500 text-white btn-sm text-xs">
                                                    üì¶ ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡πà‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå
                                                </a>
                                            ` : ''}
                                        </div>
                                        ${isFullyCompleted ? `
                                            <p class="text-xs text-green-600 mt-2">
                                                ‚úÖ ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                                            </p>
                                        ` : ''}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="flex gap-2 flex-col ml-4">
                                ${request.pdfUrl ? `
                                    <a href="${request.pdfUrl}" target="_blank" class="btn btn-success btn-sm">
                                        üìÑ ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠
                                    </a>
                                ` : ''}
                                
                                ${!isFullyCompleted ? `
                                    <button data-action="edit" data-id="${request.id}" class="btn bg-blue-500 text-white btn-sm">
                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                    </button>
                                ` : ''}
                                
                                ${!isFullyCompleted ? `
                                    <button data-action="delete" data-id="${request.id}" class="btn btn-danger btn-sm">
                                        üóëÔ∏è ‡∏•‡∏ö
                                    </button>
                                ` : ''}
                                
                                ${(!relatedMemo || relatedMemo.status === '‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç') && !isFullyCompleted ? `
    <button data-action="send-memo" data-id="${request.id}" class="btn bg-green-500 text-white btn-sm">
        üì§ ‡∏™‡πà‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    </button>
` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.classList.remove('hidden');
            noRequestsMessage.classList.add('hidden');

            container.addEventListener('click', handleRequestAction);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function getStatusColor(status) {
            const statusColors = {
                '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô/‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': 'text-green-600 font-semibold',
                '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô': 'text-green-600 font-semibold',
                'Approved': 'text-green-600 font-semibold',
                '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏≠‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 'text-blue-600',
                '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': 'text-yellow-600',
                'Pending': 'text-yellow-600',
                'Submitted': 'text-blue-600',
                '‡∏£‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÄ‡∏ö‡∏¥‡∏Å)': 'text-orange-600',
                '‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç': 'text-red-600',
                '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£': 'text-purple-600'
            };
            return statusColors[status] || 'text-gray-600';
        }
    </script>

</body>
</html>
